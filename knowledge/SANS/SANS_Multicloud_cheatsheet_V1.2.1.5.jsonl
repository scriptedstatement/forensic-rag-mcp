{"text": "Use CLIs to interact with the three most popular cloud platforms: Amazon Web Services (AWS), Microsoft Azure, and the Google Cloud Platform (GCP).", "metadata": {"source": "SANS_Multicloud", "title": "Multicloud CLI Overview", "category": "defense", "platform": "cloud"}}
{"text": "All commands, unless stated otherwise, have been tested in the SEC510 course VM using the following CLI versions: aws-cli/2.0.35, azure-cli 2.2.0, Google Cloud SDK 286.0.0, gsutil version: 4.48, jq-1.5-1-a5b5cbe", "metadata": {"source": "SANS_Multicloud", "title": "CLI Version Details", "category": "defense", "platform": "cloud"}}
{"text": "You must be authenticated and have the appropriate Identity and Access Management (IAM) permissions to run these commands.", "metadata": {"source": "SANS_Multicloud", "title": "IAM Requirements", "category": "defense", "platform": "cloud"}}
{"text": "In the AWS Console, create an IAM user and click \"Download .csv\". Then, configure interactively: aws configure", "metadata": {"source": "SANS_Multicloud", "title": "AWS Authentication - Interactive", "category": "defense", "platform": "aws"}}
{"text": "AWS configure non-interactively: aws configure set aws_access_key_id $(cat new_user_credentials.csv | sed -n 2p | awk 'BEGIN { FS = \",\" } ; { printf \"%s\", $1 }') and aws configure set aws_secret_access_key $(cat new_user_credentials.csv | sed -n 2p | awk 'BEGIN { FS = \",\" } ; { printf \"%s\", $2 }')", "metadata": {"source": "SANS_Multicloud", "title": "AWS Authentication - Non-Interactive", "category": "defense", "platform": "aws"}}
{"text": "Browser-based authentication for Azure and GCP: az login and gcloud auth login", "metadata": {"source": "SANS_Multicloud", "title": "Azure and GCP Browser Authentication", "category": "defense", "platform": "cloud"}}
{"text": "GCP authentication with a JSON key file: gcloud auth activate-service-account --key-file <Path to your key file> and gcloud config set project $(cat <Path to your key file> | jq -r \".project_id\")", "metadata": {"source": "SANS_Multicloud", "title": "GCP Service Account Authentication", "category": "defense", "platform": "gcp"}}
{"text": "Show the signed-in user: aws sts get-caller-identity (AWS), az ad signed-in-user show (Azure), gcloud auth list (GCP)", "metadata": {"source": "SANS_Multicloud", "title": "Show Signed-In User", "category": "defense", "platform": "cloud"}}
{"text": "All AWS commands support a query option. This specifies a JMESPath string to extract a portion of the output: aws iam list-users --query \"Users[0].UserName\"", "metadata": {"source": "SANS_Multicloud", "title": "AWS Query Option - JMESPath", "category": "defense", "platform": "aws"}}
{"text": "Azure CLI commands support a query option identical to AWS's: az network vnet list --query '[0].subnets[0].addressPrefix'", "metadata": {"source": "SANS_Multicloud", "title": "Azure Query Option", "category": "defense", "platform": "azure"}}
{"text": "While GCP commands do not support data extraction via a query option, they support a filter option. This will make the command only return items that match the provided Boolean expression: gcloud sql instances list --filter 'name = <Instance name> AND serverCaCert.expirationTime.date(\"%Y\") >= \"2020\"'", "metadata": {"source": "SANS_Multicloud", "title": "GCP Filter Option", "category": "defense", "platform": "gcp"}}
{"text": "When the built-in filtering and querying capabilities fall short, you can process and create JSON with jq: aws s3api list-buckets | jq -r '.Buckets[] | select(.Name | startswith(\"sec510\"))'", "metadata": {"source": "SANS_Multicloud", "title": "Using jq with AWS", "category": "defense", "platform": "aws"}}
{"text": "GCP with jq example: gcloud projects list --format json | jq -r '.[] | select(.lifecycleState==\"ACTIVE\").name'", "metadata": {"source": "SANS_Multicloud", "title": "Using jq with GCP", "category": "defense", "platform": "gcp"}}
{"text": "SSH to AWS EC2 instance: ssh ubuntu@$(aws ec2 describe-instances --filters Name=instance-state-name,Values=running Name=tag-value,Values=<Your instance name> --query \"Reservations[0].Instances[0].PublicIpAddress\" --output text)", "metadata": {"source": "SANS_Multicloud", "title": "SSH to AWS EC2 Instance", "category": "defense", "platform": "aws"}}
{"text": "SSH to Azure VM: ssh ubuntu@$(az vm list-ip-addresses --query \"[?virtualMachine.name=='<Your VM name>'].virtualMachine.network.publicIpAddresses[0].ipAddress\" --output tsv)", "metadata": {"source": "SANS_Multicloud", "title": "SSH to Azure VM", "category": "defense", "platform": "azure"}}
{"text": "SSH to GCP VM: gcloud compute ssh <Your VM name> --ssh-key-file ~/.ssh/id_rsa", "metadata": {"source": "SANS_Multicloud", "title": "SSH to GCP VM", "category": "defense", "platform": "gcp"}}
{"text": "Enumerate all buckets or storage accounts in an account: aws s3 ls s3:// (AWS), az storage account list (Azure), gsutil ls gs:// (GCP)", "metadata": {"source": "SANS_Multicloud", "title": "Enumerate Storage Buckets/Accounts", "category": "defense", "platform": "cloud"}}
{"text": "Enumerate all containers in an Azure storage account: az storage container list --account-name <Your storage account name>", "metadata": {"source": "SANS_Multicloud", "title": "Enumerate Azure Storage Containers", "category": "defense", "platform": "azure"}}
{"text": "Enumerate all objects or blobs in a bucket or container: aws s3 ls s3://<Your bucket name> (AWS), az storage blob list --account-name <Your storage account name> --container-name <Your container name> (Azure), gsutil ls gs://<Your bucket name> (GCP)", "metadata": {"source": "SANS_Multicloud", "title": "Enumerate Objects in Storage", "category": "defense", "platform": "cloud"}}
{"text": "Upload files to storage - AWS: aws s3 cp file.txt s3://<Your bucket name>", "metadata": {"source": "SANS_Multicloud", "title": "AWS S3 Upload", "category": "defense", "platform": "aws"}}
{"text": "Upload files to storage - Azure: az storage blob upload --account-name <Your storage account name> --container-name <Your container name> --name file.txt --file file.txt", "metadata": {"source": "SANS_Multicloud", "title": "Azure Blob Upload", "category": "defense", "platform": "azure"}}
{"text": "Upload files to storage - GCP: gsutil cp file.txt gs://<Your bucket name>", "metadata": {"source": "SANS_Multicloud", "title": "GCP Storage Upload", "category": "defense", "platform": "gcp"}}
{"text": "Download files from storage - AWS: aws s3 cp s3://<Your bucket name>/file.txt .", "metadata": {"source": "SANS_Multicloud", "title": "AWS S3 Download", "category": "defense", "platform": "aws"}}
{"text": "Download files from storage - Azure: az storage blob download --account-name <Your storage account name> --container-name <Your container name> --name file.txt --file file.txt", "metadata": {"source": "SANS_Multicloud", "title": "Azure Blob Download", "category": "defense", "platform": "azure"}}
{"text": "Download files from storage - GCP: gsutil cp gs://<Your bucket name>/file.txt .", "metadata": {"source": "SANS_Multicloud", "title": "GCP Storage Download", "category": "defense", "platform": "gcp"}}
{"text": "AWS KMS encrypt: aws kms encrypt --key-id <Your key ARN or alias> --plaintext SANS | jq -r '.CiphertextBlob' | base64 -d > encrypted.txt", "metadata": {"source": "SANS_Multicloud", "title": "AWS KMS Encrypt", "category": "defense", "platform": "aws"}}
{"text": "AWS KMS decrypt: aws kms decrypt --key-id <Your key ARN or alias> --ciphertext-blob fileb://encrypted.txt | jq -r '.Plaintext'", "metadata": {"source": "SANS_Multicloud", "title": "AWS KMS Decrypt", "category": "defense", "platform": "aws"}}
{"text": "Azure Key Vault only supports asymmetric encryption. az keyvault key encrypt and decrypt were added in version 2.8.0 on June 23rd, 2020.", "metadata": {"source": "SANS_Multicloud", "title": "Azure Key Vault Encryption Note", "category": "defense", "platform": "azure"}}
{"text": "Azure Key Vault encrypt: az keyvault key encrypt --algorithm RSA1_5 --vault-name <Your Key Vault name> --name <Your key name> --value SANS | jq -r '.result' > encrypted.txt", "metadata": {"source": "SANS_Multicloud", "title": "Azure Key Vault Encrypt", "category": "defense", "platform": "azure"}}
{"text": "Azure Key Vault decrypt: az keyvault key decrypt --algorithm RSA1_5 --vault-name <Your Key Vault name> --name <Your key name> --value \"$(cat encrypted.txt)\" | jq -r '.result'", "metadata": {"source": "SANS_Multicloud", "title": "Azure Key Vault Decrypt", "category": "defense", "platform": "azure"}}
{"text": "GCP KMS encrypt: echo \"SANS\" > plaintext.txt && gcloud kms encrypt --plaintext-file plaintext.txt --ciphertext-file encrypted.txt --keyring <Your keyring name> --location <Your location, such as us-central1> --key <Your key name>", "metadata": {"source": "SANS_Multicloud", "title": "GCP KMS Encrypt", "category": "defense", "platform": "gcp"}}
{"text": "GCP KMS decrypt: gcloud kms decrypt --plaintext-file new-plaintext.txt --ciphertext-file encrypted.txt --keyring <Your keyring name> --location <Your location, such as us-central1> --key <Your key name>", "metadata": {"source": "SANS_Multicloud", "title": "GCP KMS Decrypt", "category": "defense", "platform": "gcp"}}
{"text": "Alternative Azure cryptography using az rest for version 2.2.0: export REQUEST_BODY='{\"alg\": \"RSA1_5\", \"value\": \"SANS\"}' && az rest --resource https://vault.azure.net --method POST --headers \"Content-Type=application/json\" --uri \"https://<Your Key Vault name>.vault.azure.net/keys/<Your key name>/encrypt?api-version=7.0\" --body \"$REQUEST_BODY\" | jq -r '.value' > encrypted.txt", "metadata": {"source": "SANS_Multicloud", "title": "Azure REST API Encrypt Alternative", "category": "defense", "platform": "azure"}}
{"text": "Alternative Azure decrypt using az rest: export REQUEST_BODY=$(echo '{\"alg\": \"RSA1_5\"}' | jq --arg value value \". + {value: \\\"$(cat encrypted.txt)\\\"}\") && az rest --resource https://vault.azure.net --method POST --headers \"Content-Type=application/json\" --uri \"https://<Your Key Vault name>.vault.azure.net/keys/<Your key name>/decrypt?api-version=7.0\" --body \"$REQUEST_BODY\" | jq -r '.value'", "metadata": {"source": "SANS_Multicloud", "title": "Azure REST API Decrypt Alternative", "category": "defense", "platform": "azure"}}
{"text": "The AWS Systems Manager Session Manager can establish shell sessions to private EC2 instances: aws ssm start-session", "metadata": {"source": "SANS_Multicloud", "title": "AWS Systems Manager Session Manager", "category": "defense", "platform": "aws"}}
{"text": "The Azure API can be invoked using HTTP requests with az rest. These will use the same credentials used with all other commands.", "metadata": {"source": "SANS_Multicloud", "title": "Azure REST API Invocation", "category": "defense", "platform": "azure"}}
{"text": "Delete the default GCP firewall rules: gcloud compute firewall-rules delete default-allow-<Repeat for icmp, rdp, ssh, and internal>", "metadata": {"source": "SANS_Multicloud", "title": "Delete Default GCP Firewall Rules", "category": "defense", "platform": "gcp"}}
