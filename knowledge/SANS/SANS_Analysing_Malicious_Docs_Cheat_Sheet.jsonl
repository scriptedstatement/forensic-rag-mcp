{"text": "This cheat sheet outlines tips and tools for analyzing malicious documents, such as Microsoft Office, RTF, and PDF files.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Analyzing Malicious Documents Overview", "category": "malware", "platform": "windows"}}
{"text": "General Approach to Document Analysis: 1. Examine the document for anomalies, such as risky tags, scripts, and embedded artifacts.", "metadata": {"source": "SANS_Malicious_Docs", "title": "General Approach Step 1", "category": "malware", "platform": "windows"}}
{"text": "General Approach to Document Analysis: 2. Locate embedded code, such as shellcode, macros, JavaScript, or other suspicious objects.", "metadata": {"source": "SANS_Malicious_Docs", "title": "General Approach Step 2", "category": "malware", "platform": "windows"}}
{"text": "General Approach to Document Analysis: 3. Extract suspicious code or objects from the file.", "metadata": {"source": "SANS_Malicious_Docs", "title": "General Approach Step 3", "category": "malware", "platform": "windows"}}
{"text": "General Approach to Document Analysis: 4. If relevant, deobfuscate and examine macros, JavaScript, or other embedded code.", "metadata": {"source": "SANS_Malicious_Docs", "title": "General Approach Step 4", "category": "malware", "platform": "windows"}}
{"text": "General Approach to Document Analysis: 5. If relevant, emulate, disassemble and/or debug shellcode that you extracted from the document.", "metadata": {"source": "SANS_Malicious_Docs", "title": "General Approach Step 5", "category": "malware", "platform": "windows"}}
{"text": "General Approach to Document Analysis: 6. Understand the next steps in the infection chain.", "metadata": {"source": "SANS_Malicious_Docs", "title": "General Approach Step 6", "category": "malware", "platform": "windows"}}
{"text": "Binary Microsoft Office document files (.doc, .xls, etc.) use the OLE2 (a.k.a. Structured Storage) format.", "metadata": {"source": "SANS_Malicious_Docs", "title": "MS Office Format - OLE2", "category": "malware", "platform": "windows"}}
{"text": "SRP streams in OLE2 documents sometimes store a cached version of earlier VBA macro code.", "metadata": {"source": "SANS_Malicious_Docs", "title": "MS Office Format - SRP Streams", "category": "malware", "platform": "windows"}}
{"text": "OOXML document files (.docx, .xlsm, etc.) supported by Microsoft Office are compressed zip archives.", "metadata": {"source": "SANS_Malicious_Docs", "title": "MS Office Format - OOXML", "category": "malware", "platform": "windows"}}
{"text": "VBA macros in OOXML documents are stored inside an OLE2 binary file, which is within the zip archive.", "metadata": {"source": "SANS_Malicious_Docs", "title": "MS Office Format - VBA in OOXML", "category": "malware", "platform": "windows"}}
{"text": "Excel supports XLM macros that are embedded as formulas in sheets without the OLE2 binary file.", "metadata": {"source": "SANS_Malicious_Docs", "title": "MS Office Format - XLM Macros", "category": "malware", "platform": "windows"}}
{"text": "RTF documents don't support macros but can contain malicious embedded files and objects.", "metadata": {"source": "SANS_Malicious_Docs", "title": "MS Office Format - RTF", "category": "malware", "platform": "windows"}}
{"text": "zipdump.py file.pptx - Examine contents of OOXML file file.pptx.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - zipdump.py examine", "category": "malware", "platform": "windows"}}
{"text": "zipdump.py file.pptx -s 3 -d - Extract file with index 3 from file.pptx to STDOUT.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - zipdump.py extract", "category": "malware", "platform": "windows"}}
{"text": "olevba.py file.xlsm - Locate and extract macros from file.xlsm.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - olevba.py", "category": "malware", "platform": "windows"}}
{"text": "oledump.py file.xls -s 3 -v - Extract VBA source code from stream 3 in file.xls.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - oledump.py extract VBA", "category": "malware", "platform": "windows"}}
{"text": "xmldump.py pretty - Format XML file supplied via STDIN for easier analysis.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - xmldump.py", "category": "malware", "platform": "windows"}}
{"text": "oledump.py file.xls -p plugin_http_heuristics - Find obfuscated URLs in file.xls macros.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - oledump.py plugin", "category": "malware", "platform": "windows"}}
{"text": "vmonkey file.doc - Emulate the execution of macros in file.doc to analyze them.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - vmonkey", "category": "malware", "platform": "windows"}}
{"text": "evilclippy -uu file.ppt - Remove the password prompt from macros in file.ppt.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - evilclippy", "category": "malware", "platform": "windows"}}
{"text": "msoffcrypto-tool infile.docm outfile.docm -p - Decrypt outfile.docm using specified password to create outfile.docm.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - msoffcrypto-tool", "category": "malware", "platform": "windows"}}
{"text": "pcodedmp file.doc - Disassemble VBA-stomped p-code macro from file.doc.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - pcodedmp", "category": "malware", "platform": "windows"}}
{"text": "pcode2code file.doc - Decompile VBA-stomped p-code macro from file.doc.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - pcode2code", "category": "malware", "platform": "windows"}}
{"text": "rtfobj.py file.rtf - Extract objects embedded into RTF file.rtf.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - rtfobj.py", "category": "malware", "platform": "windows"}}
{"text": "rtfdump.py file.rtf - List groups and structure of RTF file file.rtf.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - rtfdump.py list", "category": "malware", "platform": "windows"}}
{"text": "rtfdump.py file.rtf -O - Examine objects in RTF file file.rtf.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - rtfdump.py objects", "category": "malware", "platform": "windows"}}
{"text": "rtfdump.py file.rtf file.doc - Extract hex contents from group in RTF file file.rtf.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - rtfdump.py hex", "category": "malware", "platform": "windows"}}
{"text": "xlmdeobfuscator --file file.xlsm - Deobfuscate XLM (Excel 4) macros in file.xlsm.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - xlmdeobfuscator", "category": "malware", "platform": "windows"}}
{"text": "/OpenAction and /AA specify the script or action to run automatically.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Risky PDF Keywords - OpenAction AA", "category": "malware", "platform": "windows"}}
{"text": "/JavaScript, /JS, /AcroForm, and /XFA can specify JavaScript to run.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Risky PDF Keywords - JavaScript", "category": "malware", "platform": "windows"}}
{"text": "/URI accesses a URL, perhaps for phishing.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Risky PDF Keywords - URI", "category": "malware", "platform": "windows"}}
{"text": "/SubmitForm and /GoToR can send data to URL.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Risky PDF Keywords - SubmitForm GoToR", "category": "malware", "platform": "windows"}}
{"text": "/ObjStm can hide objects inside an object stream.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Risky PDF Keywords - ObjStm", "category": "malware", "platform": "windows"}}
{"text": "/XObject can embed an image for phishing.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Risky PDF Keywords - XObject", "category": "malware", "platform": "windows"}}
{"text": "Be mindful of obfuscation with hex codes, such as /JavaScript vs. /J#61vaScript.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Risky PDF Keywords - Obfuscation", "category": "malware", "platform": "windows"}}
{"text": "pdfid.py file.pdf -n - Display risky keywords present in file file.pdf.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - pdfid.py", "category": "malware", "platform": "windows"}}
{"text": "pdf-parser.py file.pdf -a - Show stats about keywords. Add \"-O\" to include object streams.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - pdf-parser.py stats", "category": "malware", "platform": "windows"}}
{"text": "pdf-parser.py file.pdf -o id - Display contents of object id. Add \"-d\" to dump object's stream.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - pdf-parser.py object", "category": "malware", "platform": "windows"}}
{"text": "pdf-parser.py file.pdf -r id - Display objects that reference object id.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - pdf-parser.py reference", "category": "malware", "platform": "windows"}}
{"text": "qpdf --password=pass --decrypt infile.pdf outfile.pdf - Decrypt infile.pdf using password pass to create outfile.pdf.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - qpdf decrypt", "category": "malware", "platform": "windows"}}
{"text": "xorsearch -W -d 3 file.bin - Locate shellcode patterns inside the binary file file.bin.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - xorsearch", "category": "malware", "platform": "windows"}}
{"text": "scdbg /f file.bin - Emulate execution of shellcode in file.bin. Use \"/off\" to specify offset.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - scdbg", "category": "malware", "platform": "windows"}}
{"text": "runsc32 -f file.bin -n - Execute shellcode in file file.bin to observe behavior in an isolated lab.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - runsc32", "category": "malware", "platform": "windows"}}
{"text": "base64dump.py file.txt - List Base64-encoded strings present in file file.txt.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - base64dump.py", "category": "malware", "platform": "windows"}}
{"text": "numbers-to-string.py file - Convert numbers that represent characters in file to a string.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Command - numbers-to-string.py", "category": "malware", "platform": "windows"}}
{"text": "SpiderMonkey, cscript, and box-js help deobfuscate JavaScript that you extract from document files.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Tool - JavaScript Deobfuscation", "category": "malware", "platform": "windows"}}
{"text": "Use the debugger built into Microsoft Office to deobfuscate macros in an isolated lab.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Tool - Office Debugger", "category": "malware", "platform": "windows"}}
{"text": "Use AMSIScriptContentRetrieval.ps1 to observe Microsoft Office execute macros in an isolated lab.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Tool - AMSIScriptContentRetrieval", "category": "malware", "platform": "windows"}}
{"text": "Some automated analysis sandboxes can analyze aspects of malicious document files.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Tool - Automated Sandboxes", "category": "malware", "platform": "windows"}}
{"text": "REMnux distro includes many of the free document analysis tools mentioned above.", "metadata": {"source": "SANS_Malicious_Docs", "title": "Tool - REMnux", "category": "malware", "platform": "windows"}}
