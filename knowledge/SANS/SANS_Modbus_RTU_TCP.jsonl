{"text": "Modbus is a client-server protocol used to monitor and program devices, communicate between intelligent devices and sensors and instruments, and to monitor field devices using controllers, servers, workstations, and human machine interfaces.", "metadata": {"source": "SANS_Modbus", "title": "Modbus Protocol Overview", "category": "network", "platform": "ics"}}
{"text": "Modbus RTU is the protocol standard that defines the use of Modbus across a serial connection. The serial connection typically uses a TIA-232 / TIA-485 serial interface for communication.", "metadata": {"source": "SANS_Modbus", "title": "Modbus RTU Description", "category": "network", "platform": "ics"}}
{"text": "Modbus RTU data exchange is a simple Protocol Data Unit (PDU) that includes a unit identifier (ID), function code, data request / response, and a Cyclical Redundancy Check (CRC).", "metadata": {"source": "SANS_Modbus", "title": "Modbus RTU PDU Structure", "category": "network", "platform": "ics"}}
{"text": "Modbus TCP is a conversion of Modbus RTU to operate within a TCP payload. The Modbus server's default service port is 502.", "metadata": {"source": "SANS_Modbus", "title": "Modbus TCP Description", "category": "network", "platform": "ics"}}
{"text": "Modbus TCP data exchange is a simple PDU that includes a transaction ID, protocol ID, length field, unit ID, function code, and data request / response. The CRC is not included as it is provided by lower-level communication layers.", "metadata": {"source": "SANS_Modbus", "title": "Modbus TCP PDU Structure", "category": "network", "platform": "ics"}}
{"text": "Modbus Bit Operations: Read Coils: 1, Read-Only Discrete Inputs: 2, Write Single Coil: 5, Write Multiple Coils: 15", "metadata": {"source": "SANS_Modbus", "title": "Modbus Function Codes - Bit Operations", "category": "network", "platform": "ics"}}
{"text": "Modbus Byte Operations: Read Holding Registers: 3, Read-Only Input Registers: 4, Write Single Holding Register: 6, Write Multiple Holding Registers: 16, Read / Write Multiple Registers: 23", "metadata": {"source": "SANS_Modbus", "title": "Modbus Function Codes - Byte Operations", "category": "network", "platform": "ics"}}
{"text": "Modbus File Operations: Read File Record: 20, Write File Record: 21", "metadata": {"source": "SANS_Modbus", "title": "Modbus Function Codes - File Operations", "category": "network", "platform": "ics"}}
{"text": "Modbus RTU Request Format: Unit ID (1 byte), Function (1 byte), Start Address (2 bytes), Count (2 bytes), CRC (2 bytes)", "metadata": {"source": "SANS_Modbus", "title": "Modbus RTU Request Format", "category": "network", "platform": "ics"}}
{"text": "Modbus RTU Response Format: Unit ID (1 byte), Function (1 byte), Count (1 byte or by Function), Data (Count * 2 bytes), CRC (2 bytes)", "metadata": {"source": "SANS_Modbus", "title": "Modbus RTU Response Format", "category": "network", "platform": "ics"}}
{"text": "Modbus TCP Request Format: Transaction ID (2 bytes), Protocol ID (2 bytes), Length (2 bytes), Unit ID (1 byte), Function (1 byte), Start Address (2 bytes), Data (2 bytes or Length - 4)", "metadata": {"source": "SANS_Modbus", "title": "Modbus TCP Request Format", "category": "network", "platform": "ics"}}
{"text": "Modbus TCP Response Format: Transaction ID (2 bytes), Protocol ID (2 bytes), Length (2 bytes), Unit ID (1 byte), Function (1 byte), Count (1 byte or by Function), Data (2 bytes or Length - 4)", "metadata": {"source": "SANS_Modbus", "title": "Modbus TCP Response Format", "category": "network", "platform": "ics"}}
{"text": "The mbtget tool is maintained at: https://github.com/sourceperl/mbtget. This tool provides a simple client that interacts with a Modbus server.", "metadata": {"source": "SANS_Modbus", "title": "mbtget Tool Overview", "category": "network", "platform": "ics"}}
{"text": "mbtget command line options: -h show help, -v show version, -d set dump mode (show tx/rx frame in hex), -s set script mode (csv on stdout)", "metadata": {"source": "SANS_Modbus", "title": "mbtget General Options", "category": "network", "platform": "ics"}}
{"text": "mbtget read options: -r1 read bit(s) (function 1), -r2 read bit(s) (function 2), -r3 read word(s) (function 3), -r4 read word(s) (function 4), -r7 read exception status", "metadata": {"source": "SANS_Modbus", "title": "mbtget Read Options", "category": "network", "platform": "ics"}}
{"text": "mbtget write options: -w5 bit_value write a bit (function 5), -w6 word_value write a word (function 6)", "metadata": {"source": "SANS_Modbus", "title": "mbtget Write Options", "category": "network", "platform": "ics"}}
{"text": "mbtget connection options: -u unit_id set the modbus unit id, -p port_number set TCP port (default 502), -a modbus_address set modbus address (default 0), -n value_number number of values to read, -t timeout set timeout seconds (default is 5s)", "metadata": {"source": "SANS_Modbus", "title": "mbtget Connection Options", "category": "network", "platform": "ics"}}
{"text": "mbtget read registers example: mbtget -r3 -a 0 -n 5 -p 10502 127.0.0.1", "metadata": {"source": "SANS_Modbus", "title": "mbtget Read Registers Example", "category": "network", "platform": "ics"}}
{"text": "The Metasploit tool contains several Modbus modules. These modules include identifying devices running a Modbus server, extracting data from Modbus packet captures, and exploiting known vulnerabilities in common Program Logic Controllers (PLC).", "metadata": {"source": "SANS_Modbus", "title": "Metasploit Modbus Modules Overview", "category": "network", "platform": "ics"}}
{"text": "Metasploit module auxiliary/admin/scada/modicon_comman: Schneider Modicon Remote START/STOP Command", "metadata": {"source": "SANS_Modbus", "title": "Metasploit Modicon Command Module", "category": "network", "platform": "ics"}}
{"text": "Metasploit module auxiliary/admin/scada/modicon_stux_transfer: Schneider Modicon Ladder Logic Upload/Download", "metadata": {"source": "SANS_Modbus", "title": "Metasploit Modicon Transfer Module", "category": "network", "platform": "ics"}}
{"text": "Metasploit module auxiliary/analyze/modbus_zip: Extract zip from Modbus communication", "metadata": {"source": "SANS_Modbus", "title": "Metasploit Modbus ZIP Module", "category": "network", "platform": "ics"}}
{"text": "Metasploit module auxiliary/scanner/scada/modbus_findunitid: Modbus Unit ID and Station ID Enumerator", "metadata": {"source": "SANS_Modbus", "title": "Metasploit Modbus Unit ID Scanner", "category": "network", "platform": "ics"}}
{"text": "Metasploit module auxiliary/scanner/scada/modbusclient: Modbus Client Utility", "metadata": {"source": "SANS_Modbus", "title": "Metasploit Modbus Client Module", "category": "network", "platform": "ics"}}
{"text": "Metasploit module auxiliary/scanner/scada/modbusdetect: Modbus Version Scanner", "metadata": {"source": "SANS_Modbus", "title": "Metasploit Modbus Detect Module", "category": "network", "platform": "ics"}}
{"text": "Metasploit modbus_findunitid example: use auxiliary/scanner/scada/modbus_findunitid, set RHOSTS 127.0.0.1, set RPORT 10502, set UNIT_ID_TO 2, run", "metadata": {"source": "SANS_Modbus", "title": "Metasploit modbus_findunitid Usage", "category": "network", "platform": "ics"}}
{"text": "Wireshark and Tshark are excellent tools for conducting network analysis of Modbus communications.", "metadata": {"source": "SANS_Modbus", "title": "Modbus Network Analysis Tools", "category": "network", "platform": "ics"}}
{"text": "Modbus TCP allows for nested Modbus response / request. Thus, filters may contain read and write requests in the same packet.", "metadata": {"source": "SANS_Modbus", "title": "Modbus TCP Nested Requests", "category": "network", "platform": "ics"}}
{"text": "Wireshark display filter to show Modbus packets: Modbus", "metadata": {"source": "SANS_Modbus", "title": "Wireshark Filter - All Modbus", "category": "network", "platform": "ics"}}
{"text": "Wireshark display filter to show Modbus TCP packets: mbtcp", "metadata": {"source": "SANS_Modbus", "title": "Wireshark Filter - Modbus TCP", "category": "network", "platform": "ics"}}
{"text": "Wireshark display filter to show Modbus function code: modbus.func_code < 5", "metadata": {"source": "SANS_Modbus", "title": "Wireshark Filter - Function Code", "category": "network", "platform": "ics"}}
{"text": "Wireshark display filter to show all write functions: (modbus.func_code == 5) || (modbus.func_code == 6) || (modbus.func_code == 15) || (modbus.func_code == 16) || (modbus.func_code == 23)", "metadata": {"source": "SANS_Modbus", "title": "Wireshark Filter - Write Functions", "category": "network", "platform": "ics"}}
{"text": "Tshark filters will only display the first nested Modbus response / request when outputting packet summary.", "metadata": {"source": "SANS_Modbus", "title": "Tshark Nested Request Limitation", "category": "network", "platform": "ics"}}
{"text": "Tshark IPv4 Conversations filter: tshark -n -q -z conv,ip -Y modbus -r <file.pcap>", "metadata": {"source": "SANS_Modbus", "title": "Tshark IPv4 Conversations", "category": "network", "platform": "ics"}}
{"text": "Tshark Modbus server count: tshark -Y \"mbtcp && tcp.dstport == 502\" -T fields -e ip.dst -r <file.pcap> | sort | uniq | wc -l", "metadata": {"source": "SANS_Modbus", "title": "Tshark Server Count", "category": "network", "platform": "ics"}}
{"text": "Tshark servers by IP and Hardware Address: tshark -Y \"mbtcp && tcp.dstport == 502\" -T fields -e ip.dst -e eth.dst -r <file.pcap> | sort | uniq", "metadata": {"source": "SANS_Modbus", "title": "Tshark Servers by IP and MAC", "category": "network", "platform": "ics"}}
{"text": "Tshark client by IP Address: tshark -n -Y \"mbtcp && tcp.dstport == 502\" -T fields -e ip.src -r <file.pcap> | sort | uniq", "metadata": {"source": "SANS_Modbus", "title": "Tshark Client by IP", "category": "network", "platform": "ics"}}
{"text": "Tshark clients with function codes: tshark -n -Y \"mbtcp && tcp.dstport == 502\" -T fields -e ip.src -e modbus.func_code -r <file.pcap> | sort | uniq", "metadata": {"source": "SANS_Modbus", "title": "Tshark Clients with Function Codes", "category": "network", "platform": "ics"}}
{"text": "The current Modbus specification can be found on the Modbus Organization website at: https://www.modbus.org", "metadata": {"source": "SANS_Modbus", "title": "Modbus Specification Reference", "category": "network", "platform": "ics"}}
