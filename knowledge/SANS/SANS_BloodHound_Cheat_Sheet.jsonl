{"text": "BloodHound uses Neo4j as database, with Cypher as the query language.", "metadata": {"source": "SANS_BloodHound", "title": "BloodHound Overview", "category": "hunting", "platform": "windows"}}
{"text": "SharpHound is a popular tool for collecting the raw AD data through a domain-connected system.", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Overview", "category": "hunting", "platform": "windows"}}
{"text": "SharpHound download C#: https://github.com/BloodHoundAD/SharpHound3", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Download Links", "category": "hunting", "platform": "windows"}}
{"text": "SharpHound download ps1: https://github.com/BloodHound/Collectors", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Download Links", "category": "hunting", "platform": "windows"}}
{"text": "SharpHound download Python: https://github.com/fox-it/BloodHound.py", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Download Links", "category": "hunting", "platform": "windows"}}
{"text": "BloodHound Installation: https://bloodhound.readthedocs.io", "metadata": {"source": "SANS_BloodHound", "title": "BloodHound Installation", "category": "hunting", "platform": "windows"}}
{"text": "Using BloodHound: 1. Start Neo4j 2. Drag-and-Drop the .zip file from SharpHound onto the BloodHound interface 3. The hamburger on the top left shows the menu 4. <Analysis> contains pre-build queries 5. The highway-button opens the path-finding mode 6. Click a node to show details about the node 7. <Unrolled> items will show parent items", "metadata": {"source": "SANS_BloodHound", "title": "Using BloodHound Steps", "category": "hunting", "platform": "windows"}}
{"text": "--CollectionMethod Default - Group membership, domain trust, local admin, sessions", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Enumeration Options", "category": "hunting", "platform": "windows"}}
{"text": "--CollectionMethod Group - Group membership", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Enumeration Options", "category": "hunting", "platform": "windows"}}
{"text": "--CollectionMethod LocalAdmin - Local admin rights", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Enumeration Options", "category": "hunting", "platform": "windows"}}
{"text": "--CollectionMethod RDP - Remote Desktop Users", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Enumeration Options", "category": "hunting", "platform": "windows"}}
{"text": "--CollectionMethod ComputerOnly - Local admin, RDP, DCOM and, sessions", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Enumeration Options", "category": "hunting", "platform": "windows"}}
{"text": "--CollectionMethod Trusts - Domain trust collection", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Enumeration Options", "category": "hunting", "platform": "windows"}}
{"text": "--CollectionMethod DcOnly - Only uses LDAP to collect groups, trusts, ACL, ObjectProps, Container and GPOLocalGroup", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Enumeration Options", "category": "hunting", "platform": "windows"}}
{"text": "--CollectionMethod All - All of the above except GPOLocalGroup and LoggedOn", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Enumeration Options", "category": "hunting", "platform": "windows"}}
{"text": "--d <domainname> Provide domain name to enumerate", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Enumeration Options", "category": "hunting", "platform": "windows"}}
{"text": "--Stealth Lowers noise, runs single-threaded", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Enumeration Options", "category": "hunting", "platform": "windows"}}
{"text": "--ExcludeDomainControllers Exclude domain controllers, stealthier", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Enumeration Options", "category": "hunting", "platform": "windows"}}
{"text": "--ComputerFile <file> Provide a list of computer names or IPs", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Enumeration Options", "category": "hunting", "platform": "windows"}}
{"text": "--LDAPFilter <filter> Filter on specific AD attributes", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Enumeration Options", "category": "hunting", "platform": "windows"}}
{"text": "--DomainController <domain controller> Specify which Domain Controller to use", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Connection Options", "category": "hunting", "platform": "windows"}}
{"text": "--Throttle <value> Delay between requests in milliseconds, default=0", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Performance Options", "category": "hunting", "platform": "windows"}}
{"text": "--Jitter <value> Jitter to the Throttle value, in %", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Performance Options", "category": "hunting", "platform": "windows"}}
{"text": "--OutputDirectory <directory> To store the JSON output files, default = .", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Output Options", "category": "hunting", "platform": "windows"}}
{"text": "--OutputPrefix <prefix> Prefix to the JSON output files", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Output Options", "category": "hunting", "platform": "windows"}}
{"text": "--PrettyJson Add indentation to JSON for readability. Increases file size.", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Output Options", "category": "hunting", "platform": "windows"}}
{"text": "--NoZip Do not zip JSON files", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Output Options", "category": "hunting", "platform": "windows"}}
{"text": "--ZipFileName <name> Specify the filename for the zip", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Output Options", "category": "hunting", "platform": "windows"}}
{"text": "--EncryptZip Add password to zip (randomly generated)", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Output Options", "category": "hunting", "platform": "windows"}}
{"text": "--Loop Loop computer collections", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Loop Options", "category": "hunting", "platform": "windows"}}
{"text": "--LoopDuration hh:mm:ss Duration of the loop", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Loop Options", "category": "hunting", "platform": "windows"}}
{"text": "--LoopInterval hh:mm:ss Wait time between loops", "metadata": {"source": "SANS_BloodHound", "title": "SharpHound Loop Options", "category": "hunting", "platform": "windows"}}
{"text": "Count the LAPS-status of all computers: MATCH (c:Computer) RETURN c.haslaps, COUNT(*)", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - Computers", "category": "hunting", "platform": "windows"}}
{"text": "Get a list of all OS versions with a count: MATCH (c:Computer) RETURN DISTINCT c.operatingsystem, COUNT(c.operatingsystem)", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - Computers", "category": "hunting", "platform": "windows"}}
{"text": "Get a list of all OS versions containing 'Server': MATCH (c:Computer) WHERE c.operatingsystem CONTAINS 'Server' RETURN DISTINCT c.operatingsystem", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - Computers", "category": "hunting", "platform": "windows"}}
{"text": "Get all Windows 2008 computers and sort by last logon timestamp descending and human readable: MATCH (c:Computer) WHERE c.operatingsystem CONTAINS '2008' RETURN c.name, c.operatingsystem, datetime({ epochSeconds: toInteger(c.lastlogontimestamp) }) AS rdate ORDER BY rdate DESC", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - Computers", "category": "hunting", "platform": "windows"}}
{"text": "Get all Domain Admins: MATCH (g:Group) WHERE g.name =~ \"(?i).*DOMAIN ADMINS.*\" WITH g MATCH (g)<-[r:MemberOf*1..]-(a) RETURN a.name", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - Users", "category": "hunting", "platform": "windows"}}
{"text": "Get active sessions of Domain Admins: MATCH (u:User)-[:MemberOf*1..]->(g:Group) WHERE g.objectid ENDS WITH '-512' MATCH p = (c:Computer)-[:HasSession]->(u) return c.name, u.name", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - Users", "category": "hunting", "platform": "windows"}}
{"text": "Find all Kerberoastable users: MATCH (u:User) WHERE u.hasspn=true RETURN u.name", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - Users", "category": "hunting", "platform": "windows"}}
{"text": "Find all AS-REP-roastable users: MATCH (u:User {dontreqpreauth: true}) RETURN u.name", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - Users", "category": "hunting", "platform": "windows"}}
{"text": "Get the local admins to all computers: MATCH p=(u:User)-[r:AdminTo]->(c:Computer) RETURN u.name, c.name ORDER BY u.name", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - Users", "category": "hunting", "platform": "windows"}}
{"text": "Find all Kerberoastable users with path to DA: MATCH (u:User {hasspn:true}) MATCH (g:Group) WHERE g.name CONTAINS 'DOMAIN ADMINS' MATCH p = shortestPath( (u)-[*1..]->(g) ) RETURN p", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - Users", "category": "hunting", "platform": "windows"}}
{"text": "Find all computers domain users can RDP to: MATCH p=(g:Group)-[:CanRDP]->(c:Computer) WHERE g.objectid ENDS WITH '-513' RETURN p", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - Users", "category": "hunting", "platform": "windows"}}
{"text": "Find users that haven't logged in for 90 days: MATCH (u:User) WHERE u.lastlogon > (datetime().epochseconds - (90 * 86400)) AND NOT u.lastlogon IN [-1.0, 0.0] RETURN u.name", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - Users", "category": "hunting", "platform": "windows"}}
{"text": "Find users with passwords older than 90 days: MATCH (u:User) WHERE u.pwdlastset > (datetime().epochseconds - (90 * 86400)) AND NOT u.pwdlastset IN [-1.0, 0.0] RETURN u.name", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - Users", "category": "hunting", "platform": "windows"}}
{"text": "Find all sessions a user has in a domain: MATCH p=(c:Computer)-[r:HasSession]->(u:User {domain: \"LAB.LOCAL\"}) RETURN c.name, u.name", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - Users", "category": "hunting", "platform": "windows"}}
{"text": "Find all users member of high-value groups: MATCH p=(u:User)-[r:MemberOf*1..]->(g:Group {highvalue:true}) RETURN u.name", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - Users", "category": "hunting", "platform": "windows"}}
{"text": "Find dangerous rights for Domain Users group: MATCH p=(g:Group)-[:Owns|WriteDacl|GenericAll|WriteOwner|ExecuteDCOM|GenericWrite|AllowedToDelegate|ForceChangePassword]->(c:Computer) WHERE g.objectid ENDS WITH \"-513\" RETURN p", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - Users", "category": "hunting", "platform": "windows"}}
{"text": "Find all GPOs that contain keyword: Match (g:GPO) WHERE toUpper(g.name) CONTAINS \"SERVER\" RETURN g", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query - GPOs", "category": "hunting", "platform": "windows"}}
{"text": "MATCH indicates a search. p,c,r,u are parameters (you choose). Computer, User are the AD object type. HasSession is a relationship.", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query Buildup - MATCH", "category": "hunting", "platform": "windows"}}
{"text": "WHERE will allow for filtering (optional). Can be followed by NOT. Case sensitive. Combinations possible: WHERE NOT (c.name = \"DC\" AND c.domain = \"lab\")", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query Buildup - WHERE", "category": "hunting", "platform": "windows"}}
{"text": "CONTAINS does substring search. Others: STARTS WITH, ENDS WITH, =, <, >, ...", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query Buildup - Operators", "category": "hunting", "platform": "windows"}}
{"text": "RETURN indicates the return value. c.name is the name property for c. COUNT(*) Count per c.name the number of occurrences (optional).", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query Buildup - RETURN", "category": "hunting", "platform": "windows"}}
{"text": "RETURN COUNT(*): count the total of items (can contain multiple times the same item). RETURN DISTINCT COUNT(*): Count unique items.", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query Buildup - COUNT", "category": "hunting", "platform": "windows"}}
{"text": "Example query pattern: MATCH p=(c:Computer)-[r:HasSession]->(u:User {domain:\"lab\"})", "metadata": {"source": "SANS_BloodHound", "title": "Cypher Query Buildup - Example", "category": "hunting", "platform": "windows"}}
