{"text": "System Administrators are often on the front lines of computer security. This guide aims to support System Administrators in finding indications of a system compromise.", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Purpose", "category": "dfir", "platform": "linux"}}
{"text": "On a periodic basis (daily, weekly, or each time you logon to a system you manage,) run through these quick steps to look for anomalous behavior that might be caused by a computer intrusion. Each of these commands runs locally on a system.", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "What to use this sheet for", "category": "dfir", "platform": "linux"}}
{"text": "If you spot anomalous behavior: DO NOT PANIC! Your system may or may not have come under attack. Please contact the Incident Handling Team immediately to report the activities and get further assistance.", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Anomalous Behavior Response", "category": "dfir", "platform": "linux"}}
{"text": "Look at all running processes: # ps -aux", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Processes and Services - List All Processes", "category": "dfir", "platform": "linux"}}
{"text": "Get familiar with \"normal\" processes for the machine. Look for unusual processes. Focus on processes with root (UID 0) privileges.", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Processes and Services - Process Analysis", "category": "dfir", "platform": "linux"}}
{"text": "If you spot a process that is unfamiliar, investigate in more detail using: # lsof -p [pid]. This command shows all files and ports used by the running process.", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Processes and Services - Investigate Process with lsof", "category": "dfir", "platform": "linux"}}
{"text": "If your machine has it installed, run chkconfig to see which services are enabled at various runlevels: # chkconfig --list", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Processes and Services - Check Services", "category": "dfir", "platform": "linux"}}
{"text": "Look for unusual SUID root files: # find / -uid 0 -perm -4000 -print. This requires knowledge of normal SUID files.", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Files - SUID Root Files", "category": "dfir", "platform": "linux"}}
{"text": "Look for unusual large files (greater than 10 MegaBytes): # find / -size +10000k -print. This requires knowledge of normal large files.", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Files - Large Files", "category": "dfir", "platform": "linux"}}
{"text": "Look for files named with dots and spaces (\"...\", \".. \", \". \", and \" \") used to camouflage files: # find / -name \" \" -print, # find / -name \".. \" -print, # find / -name \". \" -print, # find / -name \" \" -print", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Files - Hidden Files with Dots and Spaces", "category": "dfir", "platform": "linux"}}
{"text": "Look for processes running out of or accessing files that have been unlinked (i.e., link count is zero). An attacker may be hiding data in or running a backdoor from such files: # lsof +L1", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Files - Unlinked Files", "category": "dfir", "platform": "linux"}}
{"text": "On a Linux machine with RPM installed (RedHat, Mandrake, etc.), run the RPM tool to verify packages: # rpm -Va | sort", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Files - RPM Package Verification", "category": "dfir", "platform": "linux"}}
{"text": "RPM verification checks size, MD5 sum, permissions, type, owner, and group of each file with information from RPM database to look for changes. Output includes: S - File size differs, M - Mode differs (permissions), 5 - MD5 sum differs, D - Device number mismatch, L - readLink path mismatch, U - user ownership differs, G - group ownership differs, T - modification time differs", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Files - RPM Verification Output Codes", "category": "dfir", "platform": "linux"}}
{"text": "Pay special attention to changes associated with items in /sbin, /bin, /usr/sbin, and /usr/bin.", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Files - Critical Directories", "category": "dfir", "platform": "linux"}}
{"text": "In some versions of Linux, this analysis is automated by the built-in check-packages script.", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Files - Automated Package Check", "category": "dfir", "platform": "linux"}}
{"text": "Look for promiscuous mode, which might indicate a sniffer: # ip link | grep PROMISC", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Network Usage - Promiscuous Mode Detection", "category": "dfir", "platform": "linux"}}
{"text": "Note that the ifconfig doesn't work reliably for detecting promiscuous mode on Linux kernel 2.4, so please use \"ip link\" for detecting it.", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Network Usage - ifconfig Limitation", "category": "dfir", "platform": "linux"}}
{"text": "Look for unusual port listeners: # netstat -nap", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Network Usage - Port Listeners", "category": "dfir", "platform": "linux"}}
{"text": "Get more details about running processes listening on ports: # lsof -i", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Network Usage - Process Port Details", "category": "dfir", "platform": "linux"}}
{"text": "These commands require knowledge of which TCP and UDP ports are normally listening on your system. Look for deviations from the norm.", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Network Usage - Baseline Knowledge", "category": "dfir", "platform": "linux"}}
{"text": "Look for unusual ARP entries, mapping IP address to MAC addresses that aren't correct for the LAN: # arp -a", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Network Usage - ARP Entries", "category": "dfir", "platform": "linux"}}
{"text": "This analysis requires detailed knowledge of which addresses are supposed to be on the LAN. On a small and/or specialized LAN (such as a DMZ), look for unexpected IP addresses.", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Network Usage - LAN Analysis", "category": "dfir", "platform": "linux"}}
{"text": "Look for cron jobs scheduled by root and any other UID 0 accounts: # crontab -u root -l", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Scheduled Tasks - Root Cron Jobs", "category": "dfir", "platform": "linux"}}
{"text": "Look for unusual system-wide cron jobs: # cat /etc/crontab, # ls /etc/cron.*", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Scheduled Tasks - System-wide Cron Jobs", "category": "dfir", "platform": "linux"}}
{"text": "Look in /etc/passwd for new accounts in sorted list by UID: # sort -nk3 -t: /etc/passwd | less", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Accounts - List Accounts by UID", "category": "dfir", "platform": "linux"}}
{"text": "Normal accounts will be there, but look for new, unexpected accounts, especially with UID < 500.", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Accounts - Low UID Accounts", "category": "dfir", "platform": "linux"}}
{"text": "Also, look for unexpected UID 0 accounts: # egrep ':0+:' /etc/passwd", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Accounts - UID 0 Accounts", "category": "dfir", "platform": "linux"}}
{"text": "On systems that use multiple authentication methods: # getent passwd | egrep ':0+:'", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Accounts - Multiple Auth Methods", "category": "dfir", "platform": "linux"}}
{"text": "Look for orphaned files, which could be a sign of an attacker's temporary account that has been deleted. # find / -nouser -print", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Accounts - Orphaned Files", "category": "dfir", "platform": "linux"}}
{"text": "Look through your system log files for suspicious events, including: \"entered promiscuous mode\"", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Log Entries - Promiscuous Mode Log", "category": "dfir", "platform": "linux"}}
{"text": "Look through your system log files for suspicious events, including: Large number of authentication or login failures from either local or remote access tools (e.g., telnetd, sshd, etc.)", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Log Entries - Authentication Failures", "category": "dfir", "platform": "linux"}}
{"text": "Look through your system log files for suspicious events, including: Remote Procedure Call (rpc) programs with a log entry that includes a large number (> 20) strange characters (such as ^PM-^PM-^PM-^PM-^PM-^PM-^PM-^PM)", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Log Entries - RPC Strange Characters", "category": "dfir", "platform": "linux"}}
{"text": "Look through your system log files for suspicious events, including: For systems running web servers: Larger than normal number of Apache logs saying \"error\"", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Log Entries - Apache Errors", "category": "dfir", "platform": "linux"}}
{"text": "Look through your system log files for suspicious events, including: Reboots and/or application restarts", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Unusual Log Entries - Reboots and Restarts", "category": "dfir", "platform": "linux"}}
{"text": "Sluggish system performance: $ uptime - Look at \"load average\"", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Other Unusual Items - System Performance", "category": "dfir", "platform": "linux"}}
{"text": "Excessive memory use: $ free", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Other Unusual Items - Memory Usage", "category": "dfir", "platform": "linux"}}
{"text": "Sudden decreases in available disk space: $ df", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Other Unusual Items - Disk Space", "category": "dfir", "platform": "linux"}}
{"text": "Chkrootkit looks for anomalies on systems introduced by user-mode and kernel-mode RootKits - www.chkrootkit.org", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Additional Supporting Tools - Chkrootkit", "category": "dfir", "platform": "linux"}}
{"text": "Tripwire looks for changes to critical system files - www.tripwire.org - free for Linux for non-commercial use", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Additional Supporting Tools - Tripwire", "category": "dfir", "platform": "linux"}}
{"text": "AIDE looks for changes to critical system files http://www.cs.tut.fi/~rammer/aide.html", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Additional Supporting Tools - AIDE", "category": "dfir", "platform": "linux"}}
{"text": "The Center for Internet Security has released a Linux hardening guide for free at www.cisecurity.org.", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Additional Supporting Tools - CIS Hardening Guide", "category": "dfir", "platform": "linux"}}
{"text": "The free Bastille Script provides automated security hardening for Linux systems, available at www.bastille-linux.org.", "metadata": {"source": "SANS_Intrusion_Discovery_Linux", "title": "Additional Supporting Tools - Bastille Script", "category": "dfir", "platform": "linux"}}
