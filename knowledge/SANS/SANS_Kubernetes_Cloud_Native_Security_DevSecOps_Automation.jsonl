{"text": "Kubernetes Cheat Sheet - Cloud Native Security and DevSecOps Automation by Eric Johnson, Cheat Sheet v1.0.0", "metadata": {"source": "SANS_Kubernetes", "title": "Document Title", "category": "defense", "platform": "cloud"}}
{"text": "Configure the kubectl CLI (sec540.com/1575)", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Authentication", "category": "defense", "platform": "cloud"}}
{"text": "Configure access to an AWS cluster: aws eks update-kubeconfig --region us-west-2 --name aviata", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Authentication", "category": "defense", "platform": "cloud"}}
{"text": "Configure access to an Azure cluster using the Entra ID auth plugin: az aks get-credentials -g ace135 -n aviata followed by kubelogin convert-kubeconfig -l azurecli", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Authentication", "category": "defense", "platform": "cloud"}}
{"text": "Configure access to a Google cluster: gcloud container clusters get-credentials --region us-west2 --project ace135 aviata", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Authentication", "category": "defense", "platform": "cloud"}}
{"text": "View Kubernetes authentication data including the user and group membership: kubectl auth whoami", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Authentication", "category": "defense", "platform": "cloud"}}
{"text": "Check RBAC permissions to list the Kubernetes pods in the aviata namespace: kubectl auth can-i get pods -n aviata", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Authentication", "category": "defense", "platform": "cloud"}}
{"text": "List cluster resources: kubectl get nodes", "metadata": {"source": "SANS_Kubernetes", "title": "Managing Kubernetes Resources", "category": "defense", "platform": "cloud"}}
{"text": "Describe an API resource and its fields: kubectl explain pods --recursive", "metadata": {"source": "SANS_Kubernetes", "title": "Managing Kubernetes Resources", "category": "defense", "platform": "cloud"}}
{"text": "Creating or updating a resource: kubectl apply -f ./namespace.yml", "metadata": {"source": "SANS_Kubernetes", "title": "Managing Kubernetes Resources", "category": "defense", "platform": "cloud"}}
{"text": "Viewing a resource in a namespace: kubectl describe pod -n aviata api", "metadata": {"source": "SANS_Kubernetes", "title": "Managing Kubernetes Resources", "category": "defense", "platform": "cloud"}}
{"text": "Deleting a resource in a namespace: kubectl delete pod -n aviata api", "metadata": {"source": "SANS_Kubernetes", "title": "Managing Kubernetes Resources", "category": "defense", "platform": "cloud"}}
{"text": "ClusterRole resources define a list of cluster-wide permissions and ClusterRoleBinding resources grant those permissions to a user or group", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes RBAC", "category": "defense", "platform": "cloud"}}
{"text": "ClusterRole grants read permissions to the cluster namespaces and customresourcedefinitions resources", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes RBAC", "category": "defense", "platform": "cloud"}}
{"text": "With the cluster role binding, members of the aviata-security-auditor group can view cluster resources: kubectl get namespaces and kubectl get customresourcedefinitions", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes RBAC", "category": "defense", "platform": "cloud"}}
{"text": "Role resources define a list of namespaced permissions and RoleBinding resources grant those permissions to a user or group", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes RBAC", "category": "defense", "platform": "cloud"}}
{"text": "With the role binding, members of the aviata-security-auditor group can view services, pods, and logs in the aviata namespace", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes RBAC", "category": "defense", "platform": "cloud"}}
{"text": "kubectl get services -n aviata", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes RBAC", "category": "defense", "platform": "cloud"}}
{"text": "kubectl logs -n aviata api", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes RBAC", "category": "defense", "platform": "cloud"}}
{"text": "Add the watch flag to see real time object updates: kubectl get pods -n aviata --watch", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes RBAC", "category": "defense", "platform": "cloud"}}
{"text": "List all resources in a namespace: kubectl api-resources --verbs=list --namespaced -o name | xargs -n 1 kubectl get --ignore-not-found --show-kind -n aviata", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Services and Deployments", "category": "defense", "platform": "cloud"}}
{"text": "List the ingress objects routing external traffic to a Kubernetes service: kubectl get ingress -n aviata", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Services and Deployments", "category": "defense", "platform": "cloud"}}
{"text": "List the service objects load balancing traffic to a group of pods: kubectl get services -n aviata", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Services and Deployments", "category": "defense", "platform": "cloud"}}
{"text": "List the deployment objects responsible for managing groups of pods (replicas): kubectl get deployments -n aviata", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Services and Deployments", "category": "defense", "platform": "cloud"}}
{"text": "Scale a deployment's replicas (# of pods): kubectl scale -n aviata --replicas 3 deployment/api", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Services and Deployments", "category": "defense", "platform": "cloud"}}
{"text": "List all pods in the cluster with more detail: kubectl get pods -A -o wide", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Services and Deployments", "category": "defense", "platform": "cloud"}}
{"text": "List all pods in a namespace including labels: kubectl get pods -n aviata --show-labels", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Services and Deployments", "category": "defense", "platform": "cloud"}}
{"text": "List all pods with a given label: kubectl get pods -n aviata -l app=api", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Services and Deployments", "category": "defense", "platform": "cloud"}}
{"text": "Shell access to a pod running in the aviata namespace with the app=api label: kubectl exec --stdin --tty -n aviata $(kubectl get pods -n aviata -l app=api -o json | jq -r .items[0].metadata.name) -- /bin/bash", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Services and Deployments", "category": "defense", "platform": "cloud"}}
{"text": "Copy a file from a pod to a host directory: kubectl cp aviata/api:/www/app.jar /tmp/app.jar", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Services and Deployments", "category": "defense", "platform": "cloud"}}
{"text": "View the logs for a deployment: kubectl logs -n aviata deployments/api", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Services and Deployments", "category": "defense", "platform": "cloud"}}
{"text": "View the logs for pods with a given label: kubectl logs -n aviata -l app=api", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Services and Deployments", "category": "defense", "platform": "cloud"}}
{"text": "View the logs for a pod's previous instantiation of a container: kubectl logs -n aviata -l app=api --previous", "metadata": {"source": "SANS_Kubernetes", "title": "Kubernetes Services and Deployments", "category": "defense", "platform": "cloud"}}
{"text": "The OPA Gatekeeper Library (sec540.com/2188) validates resources against constraint policies", "metadata": {"source": "SANS_Kubernetes", "title": "OPA Gatekeeper Library", "category": "defense", "platform": "cloud"}}
{"text": "Use Kustomize (sec540.com/1597) to install the cluster's gatekeeper library constraint templates: kubectl apply -k https://github.com/open-policy-agent/gatekeeper-library//library/general/?ref=master", "metadata": {"source": "SANS_Kubernetes", "title": "OPA Gatekeeper Library", "category": "defense", "platform": "cloud"}}
{"text": "kubectl get constrainttemplates", "metadata": {"source": "SANS_Kubernetes", "title": "OPA Gatekeeper Library", "category": "defense", "platform": "cloud"}}
{"text": "List the gatekeeper library constraints applied to resources and any associated violations: kubectl get constraints", "metadata": {"source": "SANS_Kubernetes", "title": "OPA Gatekeeper Library", "category": "defense", "platform": "cloud"}}
{"text": "Search the gatekeeper admission controller manager logs for denied resources: kubectl logs -n gatekeeper-system deployment/gatekeeper-controller-manager | grep \"denied admission\"", "metadata": {"source": "SANS_Kubernetes", "title": "OPA Gatekeeper Library", "category": "defense", "platform": "cloud"}}
{"text": "Tigera's Calico (sec540.com/1929) validates pod traffic against network policies", "metadata": {"source": "SANS_Kubernetes", "title": "Calico Network Policy", "category": "defense", "platform": "cloud"}}
{"text": "List the global network policies that apply cluster-wide rules to all namespaces: kubectl get globalnetworkpolicies.crd.projectcalico.org", "metadata": {"source": "SANS_Kubernetes", "title": "Calico Network Policy", "category": "defense", "platform": "cloud"}}
{"text": "List the network policies in the aviata namespace: kubectl get networkpolicies.crd.projectcalico.org -n aviata", "metadata": {"source": "SANS_Kubernetes", "title": "Calico Network Policy", "category": "defense", "platform": "cloud"}}
{"text": "Create a Calico NetworkPolicy blocking IMDS access with egress action Deny for destination nets 169.254.169.254/32 and fd00:ec2::254", "metadata": {"source": "SANS_Kubernetes", "title": "Calico Network Policy", "category": "defense", "platform": "cloud"}}
{"text": "The Sigstore (sec540.com/1484) Cosign Policy (sec540.com/1768) controller verifies image supply chain metadata before creating a container", "metadata": {"source": "SANS_Kubernetes", "title": "Sigstore Cosign Controller", "category": "defense", "platform": "cloud"}}
{"text": "List all namespaces with the sigstore validation label: kubectl get ns -l policy.sigstore.dev/include=true", "metadata": {"source": "SANS_Kubernetes", "title": "Sigstore Cosign Controller", "category": "defense", "platform": "cloud"}}
{"text": "Add the sigstore label to a namespace to ensure all image signatures are verified: kubectl label ns aviata policy.sigstore.dev/include=true", "metadata": {"source": "SANS_Kubernetes", "title": "Sigstore Cosign Controller", "category": "defense", "platform": "cloud"}}
{"text": "Use Helm (sec540.com/1600) to install the OpenTelemetry Kube Stack (sec540.com/2189) chart. The chart installs the OTel operator and collectors for cluster metrics, logs, and traces", "metadata": {"source": "SANS_Kubernetes", "title": "OpenTelemetry Kubernetes Stack", "category": "defense", "platform": "cloud"}}
{"text": "Add the helm repository and packages: helm repo add open-telemetry https://open-telemetry.github.io/opentelemetry-helm-charts followed by helm repo update", "metadata": {"source": "SANS_Kubernetes", "title": "OpenTelemetry Kubernetes Stack", "category": "defense", "platform": "cloud"}}
{"text": "Install the OTel Kube Stack helm chart: helm upgrade --install otel-kube-stack open-telemetry/opentelemetry-kube-stack --create-namespace --namespace otel-system --values ./otel-config.yaml", "metadata": {"source": "SANS_Kubernetes", "title": "OpenTelemetry Kubernetes Stack", "category": "defense", "platform": "cloud"}}
{"text": "Namespace YAML example with apiVersion v1, kind Namespace, metadata name aviata, and annotations ace135/owner aviata", "metadata": {"source": "SANS_Kubernetes", "title": "YAML Examples", "category": "defense", "platform": "cloud"}}
{"text": "ClusterRole YAML with apiVersion rbac.authorization.k8s.io/v1, rules for apiGroups empty string with resources namespaces and verbs get list, and apiGroups apiextensions.k8s.io with resources customresourcedefinitions and verbs get list", "metadata": {"source": "SANS_Kubernetes", "title": "YAML Examples", "category": "defense", "platform": "cloud"}}
{"text": "ClusterRoleBinding YAML with subjects kind Group, name aviata-security-auditor, apiGroup rbac.authorization.k8s.io, and roleRef kind ClusterRole name cluster-security-auditor", "metadata": {"source": "SANS_Kubernetes", "title": "YAML Examples", "category": "defense", "platform": "cloud"}}
{"text": "Role YAML with apiVersion rbac.authorization.k8s.io/v1, metadata name aviata-security-auditor namespace aviata, rules for apiGroups empty string with resources pods pods/log services and verbs get list watch", "metadata": {"source": "SANS_Kubernetes", "title": "YAML Examples", "category": "defense", "platform": "cloud"}}
{"text": "RoleBinding YAML with subjects kind Group name aviata-security-auditor apiGroup rbac.authorization.k8s.io, and roleRef kind Role name aviata-security-auditor", "metadata": {"source": "SANS_Kubernetes", "title": "YAML Examples", "category": "defense", "platform": "cloud"}}
{"text": "Calico NetworkPolicy YAML with apiVersion crd.projectcalico.org/v1, kind NetworkPolicy, metadata name deny-imds namespace aviata, spec types Egress, egress action Deny destination nets 169.254.169.254/32 and fd00:ec2::254, followed by action Allow destination nets 0.0.0.0/0 and ::/0", "metadata": {"source": "SANS_Kubernetes", "title": "YAML Examples", "category": "defense", "platform": "cloud"}}
